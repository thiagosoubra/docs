Echo.Sync.ListComponent=Core.extend(Echo.Render.ComponentSync,{$static:{DEFAULT_DIV_BORDER:"1px solid #7f7f7f",DEFAULT_SELECTED_BACKGROUND:"#0a246a",DEFAULT_SELECTED_FOREGROUND:"#ffffff"},$abstract:{listBox:null},_hasRenderedSelectedItems:false,_multipleSelect:false,_selectedIdPriority:false,_alternateRender:false,_element:null,_div:null,_focused:false,_getSelection:function(){var d=this._selectedIdPriority?null:this.component.get("selection");if(d==null){var b=this.component.get("selectedId");if(b){var a=this.component.get("items");for(var c=0;c<a.length;++c){if(a[c].id==b){d=c;break;}}}if(d==null){d=this.listBox?[]:0;}}return d;},_processBlur:function(a){this._focused=false;},_processClick:function(d){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(d);this._renderSelection();return true;}var f=this._div.firstChild;var b=0;while(f){if(f==d.target){break;}f=f.nextSibling;++b;}if(f==null){return;}if(this._multipleSelect&&d.ctrlKey){var c=this._getSelection();
if(c==null){c=[];}else{if(!(c instanceof Array)){c=[c];}else{c=c.slice();}}var a=Core.Arrays.indexOf(c,b);if(a==-1){c.push(b);}else{c.splice(a,1);}}else{c=b;}this._setSelection(c);this.component.doAction();this._renderSelection();},_processChange:function(c){if(!this.client||!this.client.verifyInput(this.component)){Core.Web.DOM.preventEventDefault(c);this._renderSelection();return false;}var b;if(this._multipleSelect){b=[];for(var a=0;a<this._element.options.length;++a){if(this._element.options[a].selected){b.push(a);}}}else{if(this._element.selectedIndex!=-1){b=this._element.selectedIndex;}}this._setSelection(b);this.component.doAction();},_processFocus:function(a){this._focused=true;if(!this.client||!this.client.verifyInput(this.component)){return true;}this.client.application.setFocusedComponent(this.component);},_processSelectStart:function(a){Core.Web.DOM.preventEventDefault(a);},renderAdd:function(b,a){this._multipleSelect=this.component.get("selectionMode")==Echo.ListBox.MULTIPLE_SELECTION;
if(this.listBox&&Core.Web.Env.QUIRK_IE_SELECT_LIST_DOM_UPDATE){this._alternateRender=true;}this._enabled=this.component.isRenderEnabled();if(this._alternateRender){this._renderMainAsDiv(b,a);}else{this._renderMainAsSelect(b,a);}},renderDisplay:function(){this._renderSelection();},renderDispose:function(a){Core.Web.Event.removeAll(this._element);this._element=null;if(this._div){Core.Web.Event.removeAll(this._div);this._div=null;}},renderFocus:function(){if(this._focused){return;}this._focused=true;Core.Web.DOM.focusElement(this._element);},_renderMainAsDiv:function(e,j){this._element=document.createElement("table");this._element.id=this.component.renderId;var a=document.createElement("tbody");this._element.appendChild(a);var g=document.createElement("tr");a.appendChild(g);var c=document.createElement("td");g.appendChild(c);this._div=document.createElement("div");c.appendChild(this._div);this._div.style.cssText="cursor:default;overflow:auto;";this._div.style.height=Echo.Sync.Extent.toCssValue(this.component.render("height","6em"),false,false);
var b=this.component.render("width");if(!Echo.Sync.Extent.isPercent(b)){this._div.style.width=Echo.Sync.Extent.toCssValue(b,true,false);}if(this._enabled){Echo.Sync.renderComponentDefaults(this.component,this._element);}else{Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this._element);Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"foreground","disabledForeground",true),this._div,"color");Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"background","disabledBackground",true),this._div,"backgroundColor");Echo.Sync.Font.render(Echo.Sync.getEffectProperty(this.component,"font","disabledFont",true),this._div);}Echo.Sync.Border.render(Echo.Sync.getEffectProperty(this.component,"border","disabledBorder",!this._enabled,Echo.Sync.ListComponent.DEFAULT_DIV_BORDER,null),this._div);Echo.Sync.Insets.render(this.component.render("insets"),this._div,"padding");var h=this.component.get("items");if(h){for(var f=0;f<h.length;++f){var d=document.createElement("div");
if(h[f].text){d.appendChild(document.createTextNode(h[f].text));}else{d.appendChild(document.createTextNode(h[f].toString()));}if(h[f].foreground){Echo.Sync.Color.render(h[f].foreground,d,"color");}if(h[f].background){Echo.Sync.Color.render(h[f].background,d,"backgroundColor");}if(h[f].font){Echo.Sync.Font.render(h[f].font,d);}this._div.appendChild(d);}}if(this._enabled){Core.Web.Event.add(this._element,"blur",Core.method(this,this._processBlur),false);Core.Web.Event.add(this._element,"focus",Core.method(this,this._processFocus),false);Core.Web.Event.add(this._div,"click",Core.method(this,this._processClick),false);Core.Web.Event.add(this._div,"selectstart",Core.method(this,this._processSelectStart),false);}j.appendChild(this._element);},_renderMainAsSelect:function(f,b){this._div=document.createElement("div");this._element=document.createElement("select");this._element.id=this.component.renderId;this._element.size=this.listBox?6:1;if(!this._enabled){this._element.disabled=true;}if(this._multipleSelect){this._element.multiple="multiple";
}this._element.style.height=Echo.Sync.Extent.toCssValue(this.component.render("height"),false,false);var e=this.component.render("width");if(e){if(Echo.Sync.Extent.isPercent(e)){if(!Core.Web.Env.QUIRK_IE_SELECT_PERCENT_WIDTH){this._div.style.width=e;this._element.style.width="100%";}}else{this._element.style.width=Echo.Sync.Extent.toCssValue(e,true,false);}}if(this._enabled){Echo.Sync.renderComponentDefaults(this.component,this._element);}else{Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this._element);Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"foreground","disabledForeground",true),this._element,"color");Echo.Sync.Color.render(Echo.Sync.getEffectProperty(this.component,"background","disabledBackground",true),this._element,"backgroundColor");Echo.Sync.Font.render(Echo.Sync.getEffectProperty(this.component,"font","disabledFont",true),this._element);}Echo.Sync.Border.render(Echo.Sync.getEffectProperty(this.component,"border","disabledBorder",!this._enabled),this._element);
Echo.Sync.Insets.render(this.component.render("insets"),this._element,"padding");var c=this.component.get("items");if(c){for(var d=0;d<c.length;++d){var a=document.createElement("option");if(c[d].text==null){a.appendChild(document.createTextNode(c[d].toString()));}else{a.appendChild(document.createTextNode(c[d].text));}if(c[d].foreground){Echo.Sync.Color.render(c[d].foreground,a,"color");}if(c[d].background){Echo.Sync.Color.render(c[d].background,a,"backgroundColor");}if(c[d].font){Echo.Sync.Font.render(c[d].font,a);}this._element.appendChild(a);}}if(this._enabled){Core.Web.Event.add(this._element,"change",Core.method(this,this._processChange),false);Core.Web.Event.add(this._element,"blur",Core.method(this,this._processBlur),false);Core.Web.Event.add(this._element,"focus",Core.method(this,this._processFocus),false);}this._div.appendChild(this._element);b.appendChild(this._div);},_renderSelection:function(){var c=this._getSelection(),b;if(this._alternateRender){if(this._hasRenderedSelectedItems){var a=this.component.get("items");
for(b=0;b<a.length;++b){Echo.Sync.Color.renderClear(a[b].foreground,this._div.childNodes[b],"color");Echo.Sync.Color.renderClear(a[b].background,this._div.childNodes[b],"backgroundColor");}}if(c instanceof Array){for(b=0;b<c.length;++b){if(c[b]>=0&&c[b]<this._div.childNodes.length){Echo.Sync.Color.render(Echo.Sync.ListComponent.DEFAULT_SELECTED_FOREGROUND,this._div.childNodes[c[b]],"color");Echo.Sync.Color.render(Echo.Sync.ListComponent.DEFAULT_SELECTED_BACKGROUND,this._div.childNodes[c[b]],"backgroundColor");}}}else{if(c>=0&&c<this._div.childNodes.length){Echo.Sync.Color.render(Echo.Sync.ListComponent.DEFAULT_SELECTED_FOREGROUND,this._div.childNodes[c],"color");Echo.Sync.Color.render(Echo.Sync.ListComponent.DEFAULT_SELECTED_BACKGROUND,this._div.childNodes[c],"backgroundColor");}}}else{if(this._hasRenderedSelectedItems){this._element.selectedIndex=-1;}if(c instanceof Array){for(b=0;b<c.length;++b){if(c[b]>=0&&c[b]<this._element.options.length){this._element.options[c[b]].selected=true;}}}else{if(c>=0&&c<this._element.options.length){this._element.options[c].selected=true;
}}}this._hasRenderedSelectedItems=true;},renderUpdate:function(c){if(c.getUpdatedProperty("selectedId")&&!c.getUpdatedProperty("selection")){this._selectedIdPriority=true;}var a=this._element;var b=a.parentNode;this.renderDispose(c);b.removeChild(a);this.renderAdd(c,b);return false;},_setSelection:function(e){this._selectedIdPriority=false;var c=null;if(e instanceof Array&&e.length==1){e=e[0];}var b=this.component.get("items");if(e instanceof Array){c=[];for(var d=0;d<e.length;++d){var a=e[d];if(a<b.length){if(b[a].id!=null){c.push(b[a].id);}}}}else{if(e<b.length){if(b[e].id!=null){c=b[e].id;}}}this.component.set("selection",e);this.component.set("selectedId",c);}});Echo.Sync.ListBox=Core.extend(Echo.Sync.ListComponent,{listBox:true,$load:function(){Echo.Render.registerPeer("ListBox",this);}});Echo.Sync.SelectField=Core.extend(Echo.Sync.ListComponent,{listBox:false,$load:function(){Echo.Render.registerPeer("SelectField",this);}});