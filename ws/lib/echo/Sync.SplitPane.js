Echo.Sync.SplitPane=Core.extend(Echo.Render.ComponentSync,{$static:{ChildPane:Core.extend({minimumSize:0,maximumSize:null,component:null,layoutData:null,scrollLeft:0,scrollTop:0,scrollRequired:false,_permanentSizes:false,_peer:null,$construct:function(b,a){this._peer=b;this.component=a;this.layoutData=a.render("layoutData");},loadDisplayData:function(){if(this._permanentSizes){return;}var a;this._permanentSizes=true;if(this.layoutData){if(this.layoutData.minimumSize){if(Echo.Sync.Extent.isPercent(this.layoutData.minimumSize)){a=this._peer._getSize();this.minimumSize=Math.round((this._peer._orientationVertical?a.height:a.width)*parseInt(this.layoutData.minimumSize,10)/100);this._permanentSizes=false;}else{this.minimumSize=Math.round(Echo.Sync.Extent.toPixels(this.layoutData.minimumSize,!this._peer._orientationVertical));}}if(this.layoutData.maximumSize){if(Echo.Sync.Extent.isPercent(this.layoutData.maximumSize)){a=this._peer._getSize();this.maximumSize=Math.round((this._peer._orientationVertical?a.height:a.width)*parseInt(this.layoutData.maximumSize,10)/100);
this._permanentSizes=false;}else{this.maximumSize=Math.round(Echo.Sync.Extent.toPixels(this.layoutData.maximumSize,!this._peer._orientationVertical));}}}},loadScrollPositions:function(a){a.scrollLeft=this.scrollLeft;a.scrollTop=this.scrollTop;},storeScrollPositions:function(a){this.scrollLeft=a.scrollLeft;this.scrollTop=a.scrollTop;}})},$load:function(){Echo.Render.registerPeer("SplitPane",this);},_childPanes:null,_paneDivs:null,_separatorDiv:null,_autoPositioned:false,_overlay:null,_redisplayRequired:false,_requested:null,_rendered:null,_processSeparatorMouseMoveRef:null,_processSeparatorMouseUpRef:null,_initialAutoSizeComplete:false,_size:null,$construct:function(){this._childPanes=[];this._paneDivs=[];this._processSeparatorMouseMoveRef=Core.method(this,this._processSeparatorMouseMove);this._processSeparatorMouseUpRef=Core.method(this,this._processSeparatorMouseUp);},clientKeyDown:function(f){var a,c,d,b;switch(f.keyCode){case 37:case 39:if(!this._orientationVertical){a=(f.keyCode==37)^(!this._orientationTopLeft);
c=this.client.application.getFocusedComponent();if(c&&c.peer&&c.peer.getFocusFlags){d=c.peer.getFocusFlags();if((a&&d&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_LEFT)||(!a&&d&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_RIGHT)){b=this.client.application.focusManager.findInParent(this.component,a);if(b){this.client.application.setFocusedComponent(b);Core.Web.DOM.preventEventDefault(f.domEvent);return false;}}}}break;case 38:case 40:if(this._orientationVertical){a=(f.keyCode==38)^(!this._orientationTopLeft);c=this.client.application.getFocusedComponent();if(c&&c.peer&&c.peer.getFocusFlags){d=c.peer.getFocusFlags();if((a&&d&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_UP)||(!a&&d&Echo.Render.ComponentSync.FOCUS_PERMIT_ARROW_DOWN)){b=this.client.application.focusManager.findInParent(this.component,a);if(b){this.client.application.setFocusedComponent(b);Core.Web.DOM.preventEventDefault(f.domEvent);return false;}}}}break;}return true;},_getBoundedSeparatorPosition:function(a){if(this._childPanes[1]){var b=this._orientationVertical?this._getSize().height:this._getSize().width;
if(a>b-this._childPanes[1].minimumSize-this._separatorSize){a=b-this._childPanes[1].minimumSize-this._separatorSize;}else{if(this._childPanes[1].maximumSize!=null&&a<b-this._childPanes[1].maximumSize-this._separatorSize){a=b-this._childPanes[1].maximumSize-this._separatorSize;}}}if(this._childPanes[0]){if(a<this._childPanes[0].minimumSize){a=this._childPanes[0].minimumSize;}else{if(this._childPanes[0].maximumSize!=null&&a>this._childPanes[0].maximumSize){a=this._childPanes[0].maximumSize;}}}return a;},_getInsetsSizeAdjustment:function(a,d){if(!d||d.insets==null){return 0;}var c=Echo.Sync.Insets.toPixels(d.insets);var b;if(this._orientationVertical){b=c.top+c.bottom;}else{b=c.left+c.right;}if(a!=null&&b>a){b=a;}return b;},getPreferredSize:function(h){if(this.component.children.length===0){return null;}var e,b,g;h=h||(Echo.Render.ComponentSync.SIZE_WIDTH|Echo.Render.ComponentSync.SIZE_HEIGHT);var f;if(this.component.children[0].peer.getPreferredSize){f=this.component.children[0].peer.getPreferredSize(h)||{};
}else{if(!this.component.children[0].pane&&(h&Echo.Render.ComponentSync.SIZE_HEIGHT)&&this._paneDivs[0].firstChild){e=new Core.Web.Measure.Bounds(this._paneDivs[0].firstChild);f={height:e.height===0?null:e.height};if(f.height){g=this.component.children[0].render("layoutData");if(g&&g.insets){b=Echo.Sync.Insets.toPixels(g.insets);f.height+=b.top+b.bottom;}}}else{f={};}}var d;if(this.component.children.length==1){d={width:0,height:0};}else{if(this.component.children[1].peer.getPreferredSize){d=this.component.children[1].peer.getPreferredSize(h)||{};}else{if(!this.component.children[1].pane&&(h&Echo.Render.ComponentSync.SIZE_HEIGHT)&&this._paneDivs[1].firstChild){e=new Core.Web.Measure.Bounds(this._paneDivs[1].firstChild);d={height:e.height===0?null:e.height};if(d.height){g=this.component.children[1].render("layoutData");if(g&&g.insets){b=Echo.Sync.Insets.toPixels(g.insets);d.height+=b.top+b.bottom;}}}else{d={};}}}var a=null;if((h&Echo.Render.ComponentSync.SIZE_HEIGHT)&&f.height!=null&&d.height!=null){if(this._orientationVertical){a=f.height+d.height+this._separatorSize;
}else{a=f.height>d.height?f.height:d.height;}}var c=null;if((h&Echo.Render.ComponentSync.SIZE_WIDTH)&&f.width!=null&&d.width!=null){if(this._orientationVertical){c=f.width>d.width?f.width:d.width;}else{c=f.width+d.width+this._separatorSize;}}return{height:a,width:c};},_getSize:function(){if(!this._size){this._size=new Core.Web.Measure.Bounds(this._splitPaneDiv);}return this._size;},_hasRelocatedChildren:function(f){var c=this._childPanes[0]?this._childPanes[0].component:null;var b=this._childPanes[1]?this._childPanes[1].component:null;var a=this.component.getComponentCount();var e=a>0?this.component.getComponent(0):null;var d=a>1?this.component.getComponent(1):null;return(c!=null&&c==d)||(b!=null&&b==e);},_loadRenderData:function(){var a=this.component.render("orientation",Echo.SplitPane.ORIENTATION_HORIZONTAL_LEADING_TRAILING);switch(a){case Echo.SplitPane.ORIENTATION_HORIZONTAL_LEADING_TRAILING:this._orientationTopLeft=this.component.getRenderLayoutDirection().isLeftToRight();this._orientationVertical=false;
break;case Echo.SplitPane.ORIENTATION_HORIZONTAL_TRAILING_LEADING:this._orientationTopLeft=!this.component.getRenderLayoutDirection().isLeftToRight();this._orientationVertical=false;break;case Echo.SplitPane.ORIENTATION_HORIZONTAL_LEFT_RIGHT:this._orientationTopLeft=true;this._orientationVertical=false;break;case Echo.SplitPane.ORIENTATION_HORIZONTAL_RIGHT_LEFT:this._orientationTopLeft=false;this._orientationVertical=false;break;case Echo.SplitPane.ORIENTATION_VERTICAL_TOP_BOTTOM:this._orientationTopLeft=true;this._orientationVertical=true;break;case Echo.SplitPane.ORIENTATION_VERTICAL_BOTTOM_TOP:this._orientationTopLeft=false;this._orientationVertical=true;break;default:throw new Error("Invalid orientation: "+a);}this._resizable=this.component.render("resizable");this._autoPositioned=this.component.render("autoPositioned");this._requested=this.component.render("separatorPosition");var b=this._resizable?Echo.SplitPane.DEFAULT_SEPARATOR_SIZE_RESIZABLE:Echo.SplitPane.DEFAULT_SEPARATOR_SIZE_FIXED;
var c=this.component.render(this._orientationVertical?"separatorHeight":"separatorWidth",b);this._separatorSize=Echo.Sync.Extent.toPixels(c,this._orientationVertical);if(this._separatorSize==null){this._separatorSize=b;}this._separatorVisible=this._resizable||(this.component.render("separatorVisible",true)&&this._separatorSize>0);if(!this._separatorVisible){this._separatorSize=0;}if(this._separatorSize>0){this._separatorColor=this.component.render("separatorColor",Echo.SplitPane.DEFAULT_SEPARATOR_COLOR);this._separatorRolloverColor=this.component.render("separatorRolloverColor")||Echo.Sync.Color.adjust(this._separatorColor,32,32,32);this._separatorImage=this.component.render(this._orientationVertical?"separatorVerticalImage":"separatorHorizontalImage");this._separatorRolloverImage=this.component.render(this._orientationVertical?"separatorVerticalRolloverImage":"separatorHorizontalRolloverImage");}},_overlayAdd:function(){if(this._overlay){return;}this._overlay=document.createElement("div");
this._overlay.style.cssText="position:absolute;z-index:32600;width:100%;height:100%;";Echo.Sync.FillImage.render(this.client.getResourceUrl("Echo","resource/Transparent.gif"),this._overlay);document.body.appendChild(this._overlay);},_overlayRemove:function(){if(!this._overlay){return;}document.body.removeChild(this._overlay);this._overlay=null;},_processSeparatorMouseDown:function(a){if(!this.client||!this.client.verifyInput(this.component)){return true;}Core.Web.DOM.preventEventDefault(a);Core.Web.dragInProgress=true;this._dragInitPosition=this._rendered;if(this._orientationVertical){this._dragInitMouseOffset=a.clientY;}else{this._dragInitMouseOffset=a.clientX;}Core.Web.Event.add(document.body,"mousemove",this._processSeparatorMouseMoveRef,true);Core.Web.Event.add(document.body,"mouseup",this._processSeparatorMouseUpRef,true);this._overlayAdd();},_processSeparatorMouseMove:function(a){var b=this._orientationVertical?a.clientY:a.clientX;this._rendered=this._getBoundedSeparatorPosition(this._orientationTopLeft?this._dragInitPosition+b-this._dragInitMouseOffset:this._dragInitPosition-b+this._dragInitMouseOffset);
this._redraw(this._rendered);},_processSeparatorMouseUp:function(a){Core.Web.DOM.preventEventDefault(a);this._overlayRemove();Core.Web.dragInProgress=false;this._removeSeparatorListeners();this.component.set("separatorPosition",this._rendered);this._requested=this._rendered;if(this._paneDivs[0]){Core.Web.VirtualPosition.redraw(this._paneDivs[0]);}if(this._paneDivs[1]){Core.Web.VirtualPosition.redraw(this._paneDivs[1]);}Echo.Render.notifyResize(this.component);},_processSeparatorRolloverEnter:function(a){if(!this.client||!this.client.verifyInput(this.component)){return true;}if(this._separatorRolloverImage){Echo.Sync.FillImage.render(this._separatorRolloverImage,this._separatorDiv,0);}else{Echo.Sync.Color.render(this._separatorRolloverColor,this._separatorDiv,"backgroundColor");}},_processSeparatorRolloverExit:function(a){if(this._separatorRolloverImage){Echo.Sync.FillImage.renderClear(this._separatorImage,this._separatorDiv,0);}else{Echo.Sync.Color.render(this._separatorColor,this._separatorDiv,"backgroundColor");
}},_redraw:function(b){var e=0;if(this.component.getComponentCount()>0){var d=this.component.getComponent(0).render("layoutData");e=this._getInsetsSizeAdjustment(b,d);}var a=this._orientationVertical?"height":"width";var c=this._orientationVertical?(this._orientationTopLeft?"top":"bottom"):(this._orientationTopLeft?"left":"right");if(this._paneDivs[0]){this._paneDivs[0].style[a]=(b-e)+"px";}if(this._paneDivs[1]){this._paneDivs[1].style[c]=(b+this._separatorSize)+"px";}if(this._separatorDiv){this._separatorDiv.style[c]=b+"px";}},_removeSeparatorListeners:function(){Core.Web.Event.remove(document.body,"mousemove",this._processSeparatorMouseMoveRef,true);Core.Web.Event.remove(document.body,"mouseup",this._processSeparatorMouseUpRef,true);},renderAdd:function(h,a){this._initialAutoSizeComplete=false;this._loadRenderData();var b=this.component.getComponentCount();if(b>2){throw new Error("Cannot render SplitPane with more than two child components.");}var f=b<1?null:this.component.getComponent(0);
var d=b<2?null:this.component.getComponent(1);this._splitPaneDiv=document.createElement("div");this._splitPaneDiv.id=this.component.renderId;this._splitPaneDiv.style.cssText="position:absolute;overflow:hidden;top:0;left:0;right:0;bottom:0;";Echo.Sync.renderComponentDefaults(this.component,this._splitPaneDiv);if(this._separatorVisible){this._separatorDiv=document.createElement("div");this._separatorDiv.style.cssText="position:absolute;font-size:1px;line-height:0;z-index:2;";Echo.Sync.Color.render(this._separatorColor,this._separatorDiv,"backgroundColor");var e=null;if(this._orientationVertical){e=this._orientationTopLeft?"s-resize":"n-resize";this._separatorDiv.style.width="100%";this._separatorDiv.style.height=this._separatorSize+"px";Echo.Sync.FillImage.render(this._separatorImage,this._separatorDiv,0);}else{e=this._orientationTopLeft?"e-resize":"w-resize";this._separatorDiv.style.height="100%";this._separatorDiv.style.width=this._separatorSize+"px";Echo.Sync.FillImage.render(this._separatorImage,this._separatorDiv,0);
}if(this._resizable&&e){this._separatorDiv.style.cursor=e;}this._splitPaneDiv.appendChild(this._separatorDiv);}else{this._separatorDiv=null;}for(var c=0;c<b&&c<2;++c){var g=this.component.getComponent(c);this._renderAddChild(h,g,c);}a.appendChild(this._splitPaneDiv);if(this._resizable){Core.Web.Event.add(this._separatorDiv,"mousedown",Core.method(this,this._processSeparatorMouseDown),false);Core.Web.Event.add(this._separatorDiv,"mouseover",Core.method(this,this._processSeparatorRolloverEnter),false);Core.Web.Event.add(this._separatorDiv,"mouseout",Core.method(this,this._processSeparatorRolloverExit),false);}},_renderAddChild:function(f,e,b){var d=this.component.indexOf(e);var a=document.createElement("div");this._paneDivs[b]=a;a.style.cssText="position: absolute; overflow: auto; z-index: 1;";var c=e.render("layoutData");if(c){Echo.Sync.Alignment.render(c.alignment,a,false,this.component);Echo.Sync.Color.render(c.background,a,"backgroundColor");Echo.Sync.FillImage.render(c.backgroundImage,a);
if(!e.pane){Echo.Sync.Insets.render(c.insets,a,"padding");switch(c.overflow){case Echo.SplitPane.OVERFLOW_HIDDEN:a.style.overflow="hidden";break;case Echo.SplitPane.OVERFLOW_SCROLL:a.style.overflow="scroll";break;}}}if(e.pane){a.style.overflow="hidden";}if(this._orientationVertical){a.style.left=0;a.style.right=0;if((this._orientationTopLeft&&b===0)||(!this._orientationTopLeft&&b==1)){a.style.top=0;}else{a.style.bottom=0;}}else{a.style.top="0";a.style.bottom="0";if((this._orientationTopLeft&&b===0)||(!this._orientationTopLeft&&b==1)){a.style.left=0;}else{a.style.right=0;}}Echo.Render.renderComponentAdd(f,e,a);this._splitPaneDiv.appendChild(a);if(this._childPanes[b]&&this._childPanes[b].component==e){this._childPanes[b].scrollRequired=true;}else{this._childPanes[b]=new Echo.Sync.SplitPane.ChildPane(this,e);}},renderDisplay:function(){Core.Web.VirtualPosition.redraw(this._splitPaneDiv);Core.Web.VirtualPosition.redraw(this._paneDivs[0]);Core.Web.VirtualPosition.redraw(this._paneDivs[1]);this._size=null;
if(this._childPanes[0]){this._childPanes[0].loadDisplayData();}if(this._childPanes[1]){this._childPanes[1].loadDisplayData();}var a=this._requested;if(a==null&&this._autoPositioned&&this._paneDivs[0]){if(this.component.children[0].peer.getPreferredSize){var c=this.component.children[0].peer.getPreferredSize(this._orientationVertical?Echo.Render.ComponentSync.SIZE_HEIGHT:Echo.Render.ComponentSync.SIZE_WIDTH);a=c?(this._orientationVertical?c.height:c.width):null;}if(a==null&&this._orientationVertical&&!this.component.children[0].pane){this._paneDivs[0].style.height="";var d=new Core.Web.Measure.Bounds(this._paneDivs[0]);a=d.height;}if(a!=null&&!this._initialAutoSizeComplete){this._initialAutoSizeComplete=true;var f=Core.method(this,function(){if(this.component){Echo.Render.renderComponentDisplay(this.component);}});Core.Web.Image.monitor(this._paneDivs[0],f);}}if(a==null){a=Echo.SplitPane.DEFAULT_SEPARATOR_POSITION;}if(Echo.Sync.Extent.isPercent(a)){var b=this._orientationVertical?this._getSize().height:this._getSize().width;
a=Math.round((parseInt(a,10)/100)*b);}else{a=Math.round(Echo.Sync.Extent.toPixels(a,!this._orientationVertical));}this._rendered=this._getBoundedSeparatorPosition(a);this._redraw(this._rendered);Core.Web.VirtualPosition.redraw(this._paneDivs[0]);Core.Web.VirtualPosition.redraw(this._paneDivs[1]);for(var e=0;e<this._childPanes.length;++e){if(this._childPanes[e]&&this._childPanes[e].scrollRequired&&this._paneDivs[e]){this._childPanes[e].loadScrollPositions(this._paneDivs[e]);this._childPanes[e].scrollRequired=false;}}},renderDispose:function(b){this._overlayRemove();for(var a=0;a<2;++a){if(this._paneDivs[a]){if(this._childPanes[a]){this._childPanes[a].storeScrollPositions(this._paneDivs[a]);}this._paneDivs[a]=null;}}if(this._separatorDiv){Core.Web.Event.removeAll(this._separatorDiv);this._separatorDiv=null;}Core.Web.Event.removeAll(this._splitPaneDiv);this._splitPaneDiv=null;},_renderRemoveChild:function(c,b){var a;if(this._childPanes[0]&&this._childPanes[0].component==b){a=0;}else{if(this._childPanes[1]&&this._childPanes[1].component==b){a=1;
}else{return;}}this._childPanes[a]=null;Core.Web.DOM.removeNode(this._paneDivs[a]);this._paneDivs[a]=null;},renderUpdate:function(g){var d=false,c;if(this._hasRelocatedChildren()){d=true;}else{if(g.hasUpdatedProperties()||g.hasUpdatedLayoutDataChildren()){if(g.isUpdatedPropertySetIn({separatorPosition:true})){this._requested=this.component.render("separatorPosition");}else{d=true;}}}if(!d&&(g.hasAddedChildren()||g.hasRemovedChildren())){var a=g.getRemovedChildren();if(a){for(c=0;c<a.length;++c){this._renderRemoveChild(g,a[c]);}}var e=g.getAddedChildren();if(e){for(c=0;c<e.length;++c){this._renderAddChild(g,e[c],this.component.indexOf(e[c]));}}}if(d){var b=this._splitPaneDiv;var f=b.parentNode;Echo.Render.renderComponentDispose(g,g.parent);f.removeChild(b);this.renderAdd(g,f);}return d;}});