Echo.Render={_loadedPeerCount:0,_nextPeerId:0,_peers:{},_disposedComponents:null,_componentDepthArraySort:function(d,c){return Echo.Render._getComponentDepth(d.parent)-Echo.Render._getComponentDepth(c.parent);},_doRenderDisplay:function(b,a){var d,c=b;var e=c.parent;while(e){if(e.peer.isChildVisible&&!e.peer.isChildVisible(c)){return;}c=e;e=e.parent;}if(a){Echo.Render._doRenderDisplayImpl(b);}else{if(b.peer.isChildVisible){for(d=0;d<b.children.length;++d){if(b.peer.isChildVisible(b.children[d])){Echo.Render._doRenderDisplayImpl(b.children[d]);}}}else{for(d=0;d<b.children.length;++d){Echo.Render._doRenderDisplayImpl(b.children[d]);}}}},_doRenderDisplayImpl:function(a){if(!a.peer){return;}if(a.peer.renderDisplay){a.peer.renderDisplay();}a.peer.displayed=true;var b;if(a.peer.isChildVisible){for(b=0;b<a.children.length;++b){if(a.peer.isChildVisible(a.children[b])){Echo.Render._doRenderDisplayImpl(a.children[b]);}}}else{for(b=0;b<a.children.length;++b){Echo.Render._doRenderDisplayImpl(a.children[b]);
}}},_getComponentDepth:function(a){var b=-1;while(a!=null){a=a.parent;++b;}return b;},_loadPeer:function(a,b){if(b.peer){return;}var c=Echo.Render._peers[b.componentType];if(!c){throw new Error("Peer not found for: "+b.componentType);}++this._loadedPeerCount;b.peer=new c();b.peer._peerId=this._nextPeerId++;b.peer.component=b;b.peer.client=a;},notifyResize:function(a){Echo.Render._doRenderDisplay(a,false);},_processDispose:function(c){var a,b=c.getRemovedDescendants();if(b){for(a=0;a<b.length;++a){Echo.Render._renderComponentDisposeImpl(c,b[a]);}}b=c.getRemovedChildren();if(b){for(a=0;a<b.length;++a){Echo.Render._renderComponentDisposeImpl(c,b[a]);}}},processUpdates:function(c){var g=c.application.updateManager;if(!g.hasUpdates()){return;}Echo.Render._disposedComponents={};var l=g.getUpdates();l.sort(Echo.Render._componentDepthArraySort);var h,f,e;for(f=0;f<l.length;++f){l[f].renderContext={};h=l[f].parent.peer;if(h==null&&l[f].parent.componentType=="Root"){Echo.Render._loadPeer(c,l[f].parent);
}}for(f=l.length-1;f>=0;--f){if(l[f]==null){continue;}h=l[f].parent.peer;Echo.Render._processDispose(l[f]);}if(Echo.Client.profilingTimer){Echo.Client.profilingTimer.mark("rem");}for(f=0;f<l.length;++f){if(l[f]==null){continue;}h=l[f].parent.peer;var m=h.renderUpdate(l[f]);if(m){for(e=f+1;e<l.length;++e){if(l[e]!=null&&l[f].parent.isAncestorOf(l[e].parent)){l[e]=null;}}}Echo.Render._setPeerDisposedState(l[f].parent,false);}if(Echo.Client.profilingTimer){Echo.Client.profilingTimer.mark("up");}var d=[];for(f=0;f<l.length;++f){if(l[f]==null){continue;}var b=false;for(e=0;e<d.length;++e){if(d[e].isAncestorOf(l[f].parent)){b=true;break;}}if(b){continue;}if(l[f].renderContext.displayRequired){for(e=0;e<l[f].renderContext.displayRequired.length;++e){d.push(l[f].renderContext.displayRequired[e]);Echo.Render._doRenderDisplay(l[f].renderContext.displayRequired[e],true);}}else{d.push(l[f].parent);Echo.Render._doRenderDisplay(l[f].parent,true);}}if(Echo.Client.profilingTimer){Echo.Client.profilingTimer.mark("disp");
}for(var a in Echo.Render._disposedComponents){var k=Echo.Render._disposedComponents[a];Echo.Render._unloadPeer(k);}Echo.Render._disposedComponents=null;g.purge();Echo.Render.updateFocus(c);},registerPeer:function(a,b){if(this._peers[a]){throw new Error("Peer already registered: "+a);}this._peers[a]=b;},renderComponentAdd:function(c,b,a){if(!b.parent||!b.parent.peer||!b.parent.peer.client){throw new Error("Cannot find reference to the Client with which this component should be associated: "+"cannot load peer.  This is due to the component's parent's peer not being associated with a Client. "+"Component = "+b+", Parent = "+b.parent+", Parent Peer = "+(b.parent?b.parent.peer:"N/A")+", Parent Peer Client = "+((b.parent&&b.parent.peer)?b.parent.peer.client:"N/A"));}Echo.Render._loadPeer(b.parent.peer.client,b);Echo.Render._setPeerDisposedState(b,false);b.peer.renderAdd(c,a);},renderComponentDisplay:function(a){this._doRenderDisplay(a,true);},renderComponentDispose:function(b,a){this._renderComponentDisposeImpl(b,a);
},_renderComponentDisposeImpl:function(c,a){if(!a.peer||a.peer.disposed){return;}Echo.Render._setPeerDisposedState(a,true);a.peer.renderDispose(c);for(var b=0;b<a.children.length;++b){Echo.Render._renderComponentDisposeImpl(c,a.children[b]);}},renderComponentHide:function(a){if(!a.peer||a.peer.disposed){return;}if(a.peer.displayed){if(a.peer.renderHide){a.peer.renderHide();}a.peer.displayed=false;for(var b=0;b<a.children.length;++b){Echo.Render.renderComponentHide(a.children[b]);}}},_setPeerDisposedState:function(a,b){if(b){a.peer.disposed=true;Echo.Render._disposedComponents[a.peer._peerId]=a;}else{a.peer.disposed=false;delete Echo.Render._disposedComponents[a.peer._peerId];}},_unloadPeer:function(a){a.peer.client=null;a.peer.component=null;a.peer=null;--this._loadedPeerCount;},updateFocus:function(a){var b=a.application.getFocusedComponent();if(b&&b.peer){if(!b.peer.renderFocus){throw new Error("Cannot focus component: "+b+", peer does not provide renderFocus() implementation.");}b.peer.renderFocus();
}else{Core.Web.DOM.focusElement(null);}}};Echo.Render.ComponentSync=Core.extend({$static:{FOCUS_PERMIT_ARROW_UP:1,FOCUS_PERMIT_ARROW_DOWN:2,FOCUS_PERMIT_ARROW_LEFT:4,FOCUS_PERMIT_ARROW_RIGHT:8,FOCUS_PERMIT_ARROW_ALL:15,SIZE_HEIGHT:1,SIZE_WIDTH:2},_peerId:null,client:null,component:null,displayed:false,disposed:false,$construct:function(){},$abstract:{renderAdd:function(b,a){},renderDispose:function(a){},renderUpdate:function(a){}},$virtual:{clientKeyDown:null,clientKeyPress:null,clientKeyUp:null,getFocusFlags:null,getPreferredSize:null,isChildVisible:null,renderFocus:null,renderHide:null,renderDisplay:null}});Echo.Render.RootSync=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Root",this);},renderAdd:function(b,a){throw new Error("Unsupported operation: renderAdd().");},_renderContent:function(b){Echo.Render.renderComponentDispose(b,b.parent);Core.Web.DOM.removeAllChildren(this.client.domainElement);for(var a=0;a<b.parent.children.length;++a){Echo.Render.renderComponentAdd(b,b.parent.children[a],this.client.domainElement);
}},renderDispose:function(a){},renderUpdate:function(d){var b,a=false;if(d.fullRefresh||d.hasAddedChildren()||d.hasRemovedChildren()){Echo.Sync.renderComponentDefaults(this.component,this.client.domainElement);var c=this.component.render("title");if(c){document.title=c;}this._renderContent(d);a=true;}else{this.client.domainElement.dir=this.client.application.getLayoutDirection().isLeftToRight()?"ltr":"rtl";if(d.hasUpdatedProperties()){b=d.getUpdatedProperty("title");if(b){document.title=b.newValue;}b=d.getUpdatedProperty("background");if(b){Echo.Sync.Color.renderClear(b.newValue,this.client.domainElement,"backgroundColor");}b=d.getUpdatedProperty("foreground");if(b){Echo.Sync.Color.renderClear(b.newValue,this.client.domainElement,"foreground");}b=d.getUpdatedProperty("font");if(b){Echo.Sync.Font.renderClear(b.newValue,this.client.domainElement);}Echo.Sync.LayoutDirection.render(this.component.getLayoutDirection(),this.client.domainElement);}}return a;}});