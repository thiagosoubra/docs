Echo.Serial={_translatorMap:{},_translatorTypeData:[],addPropertyTranslator:function(b,a){this._translatorMap[b]=a;},addPropertyTranslatorByType:function(b,a){this._translatorTypeData.push(b,a);},getPropertyTranslator:function(a){return this._translatorMap[a];},getPropertyTranslatorByType:function(b){for(var a=0;a<this._translatorTypeData.length;a+=2){if(this._translatorTypeData[a]==b){return this._translatorTypeData[a+1];}}return null;},loadComponent:function(d,c,g,h){if(!c.nodeName=="c"){throw new Error("Element is not a component.");}var i=c.getAttribute("t");var b=c.getAttribute("i");var j=Echo.ComponentFactory.newInstance(i,b);var f=j.getLocalStyleData();var e=c.firstChild;while(e){if(e.nodeType==1){switch(e.nodeName){case"c":var a=this.loadComponent(d,e,g,h);j.add(a);break;case"p":this.loadProperty(d,e,j,f,g);break;case"s":j.setStyleName(e.firstChild?e.firstChild.nodeValue:null);break;case"sr":j.setStyle(h?h[e.firstChild.nodeValue]:null);break;case"e":this._loadComponentEvent(d,e,j);
break;case"en":j.setEnabled(e.firstChild.nodeValue=="true");break;case"locale":j.setLocale(e.firstChild?e.firstChild.nodeValue:null);break;case"dir":j.setLayoutDirection(e.firstChild?(e.firstChild.nodeValue=="rtl"?Echo.LayoutDirection.RTL:Echo.LayoutDirection.LTR):null);break;case"f":if(e.getAttribute("n")){j.focusNextId=e.getAttribute("n");}if(e.getAttribute("p")){j.focusPreviousId=e.getAttribute("p");}}}e=e.nextSibling;}return j;},_loadComponentEvent:function(a,c,b){if(a.addComponentListener){var d=c.getAttribute("t");a.addComponentListener(b,d);}},loadProperty:function(d,k,e,h,i){var a=k.getAttribute("n");var j=k.getAttribute("t");var g=k.getAttribute("x");var l;if(j){var f=Echo.Serial._translatorMap[j];if(!f){throw new Error("Translator not available for property type: "+j);}l=f.toProperty(d,k);}else{if(i){var c=k.getAttribute("r");if(c){l=i[c];}else{l=Echo.Serial.String.toProperty(d,k);}}else{l=Echo.Serial.String.toProperty(d,k);}}if(a){if(h){if(g==null){h[a]=l;}else{var m=h[a];if(!m){m=[];
h[a]=m;}m[g]=l;}}else{if(g==null){e.set(a,l);}else{e.setIndex(a,g,l);}}}else{var b=k.getAttribute("m");if(g==null){e[b](l);}else{e[b](g,l);}}},loadStyleSheet:function(c,b,a){var g=new Echo.StyleSheet();var f=b.firstChild;while(f){if(f.nodeType==1){if(f.nodeName=="s"){var e={};var d=f.firstChild;while(d){if(d.nodeType==1){if(d.nodeName=="p"){this.loadProperty(c,d,null,e,a);}}d=d.nextSibling;}g.setStyle(f.getAttribute("n")||"",f.getAttribute("t"),e);}}f=f.nextSibling;}return g;},storeProperty:function(a,b,d){if(d==null){}else{if(typeof(d)=="object"){var c=null;if(d.className){c=this._translatorMap[d.className];}else{c=this.getPropertyTranslatorByType(d.constructor);}if(!c||!c.toXml){return;}c.toXml(a,b,d);}else{b.appendChild(b.ownerDocument.createTextNode(d.toString()));}}}};Echo.Serial.PropertyTranslator=Core.extend({$abstract:true,$static:{toProperty:function(a,b){return null;},toXml:null}});Echo.Serial.Null=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){return null;
}},$load:function(){Echo.Serial.addPropertyTranslator("0",this);}});Echo.Serial.Boolean=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){return b.firstChild.data=="true";}},$load:function(){Echo.Serial.addPropertyTranslator("b",this);}});Echo.Serial.Integer=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){return parseInt(b.firstChild.data,10);}},$load:function(){Echo.Serial.addPropertyTranslator("i",this);}});Echo.Serial.Number=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){return parseFloat(b.firstChild.data);}},$load:function(){Echo.Serial.addPropertyTranslator("n",this);}});Echo.Serial.String=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){var d=b.firstChild;if(!d){return"";}var c=d.data;while(d.nextSibling){d=d.nextSibling;c+=d.data;}return c;}},$load:function(){Echo.Serial.addPropertyTranslator("s",this);}});Echo.Serial.Date=Core.extend(Echo.Serial.PropertyTranslator,{$static:{_expr:/(\d{4})\.(\d{2}).(\d{2})/,toProperty:function(b,c){var d=Echo.Serial.String.toProperty(b,c);
var a=this._expr.exec(d);if(!a){return null;}return new Date(a[1],parseInt(a[2],10)-1,a[3]);},toXml:function(a,b,c){b.appendChild(b.ownerDocument.createTextNode(c.getFullYear()+"."+(c.getMonth()+1)+"."+c.getDate()));}},$load:function(){Echo.Serial.addPropertyTranslator("d",this);Echo.Serial.addPropertyTranslatorByType(Date,this);}});Echo.Serial.Map=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){var d={};var c=b.firstChild;while(c){if(c.nodeType!=1){continue;}Echo.Serial.loadProperty(a,c,null,d,null);c=c.nextSibling;}return d;}},$load:function(){Echo.Serial.addPropertyTranslator("m",this);}});Echo.Serial.Alignment=Core.extend(Echo.Serial.PropertyTranslator,{$static:{_HORIZONTAL_MAP:{"leading":"leading","trailing":"trailing","left":"left","center":"center","right":"right"},_VERTICAL_MAP:{"top":"top","center":"middle","bottom":"bottom"},toProperty:function(a,c){var d=Core.Web.DOM.getChildElementByTagName(c,"a");var e=this._HORIZONTAL_MAP[d.getAttribute("h")];
var b=this._VERTICAL_MAP[d.getAttribute("v")];if(e){if(b){return{horizontal:e,vertical:b};}return e;}if(b){return b;}return null;}},$load:function(){Echo.Serial.addPropertyTranslator("Alignment",this);Echo.Serial.addPropertyTranslator("AL",this);}});Echo.Serial.Border=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){if(b.firstChild.nodeType==3){return b.firstChild.data;}else{if(b.getAttribute("v")){return b.getAttribute("v");}else{var d=Core.Web.DOM.getChildElementByTagName(b,"b");var c={};var e=d.getAttribute("t");if(e){c.top=e;e=d.getAttribute("r");if(e){c.right=e;e=d.getAttribute("b");if(e){c.bottom=e;e=d.getAttribute("l");if(e){c.left=e;}}}}else{throw new Error("Invalid multi-sided border: no sides set.");}return c;}}}},$load:function(){Echo.Serial.addPropertyTranslator("Border",this);Echo.Serial.addPropertyTranslator("BO",this);}});Echo.Serial.FillImage=Core.extend(Echo.Serial.PropertyTranslator,{$static:{parseElement:function(b,c){var d=c.getAttribute("u");
if(b.decompressUrl){d=b.decompressUrl(d);}var e=c.getAttribute("r");var a=c.getAttribute("x");var f=c.getAttribute("y");if(e||a||f){return{url:d,repeat:e,x:a,y:f};}else{return d;}},toProperty:function(a,b){var c=Core.Web.DOM.getChildElementByTagName(b,"fi");return this.parseElement(a,c);}},$load:function(){Echo.Serial.addPropertyTranslator("FillImage",this);Echo.Serial.addPropertyTranslator("FI",this);}});Echo.Serial.FillImageBorder=Core.extend(Echo.Serial.PropertyTranslator,{$static:{_NAMES:["topLeft","top","topRight","left","right","bottomLeft","bottom","bottomRight"],_parseElement:function(a,e){var d={contentInsets:e.getAttribute("ci")?e.getAttribute("ci"):null,borderInsets:e.getAttribute("bi")?e.getAttribute("bi"):null,color:e.getAttribute("bc")};var c=e.firstChild;var b=0;while(c){if(c.nodeType==1){if(c.nodeName=="fi"){d[this._NAMES[b]]=Echo.Serial.FillImage.parseElement(a,c);++b;}else{if(c.nodeName=="null-fi"){++b;}}}c=c.nextSibling;}if(!(b===0||b==8)){throw new Error("Invalid FillImageBorder image count: "+b);
}return d;},toProperty:function(a,b){var c=Core.Web.DOM.getChildElementByTagName(b,"fib");return Echo.Serial.FillImageBorder._parseElement(a,c);}},$load:function(){Echo.Serial.addPropertyTranslator("FillImageBorder",this);Echo.Serial.addPropertyTranslator("FIB",this);}});Echo.Serial.Font=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(b,d){var g=Core.Web.DOM.getChildElementByTagName(d,"f");var a=Core.Web.DOM.getChildElementsByTagName(g,"tf");var c={};if(a.length>1){c.typeface=[];for(var f=0;f<a.length;++f){c.typeface[f]=a[f].firstChild.data;}}else{if(a.length==1){c.typeface=a[0].firstChild.data;}}var e=g.getAttribute("sz");if(e){c.size=e;}if(g.getAttribute("bo")){c.bold=true;}if(g.getAttribute("it")){c.italic=true;}if(g.getAttribute("un")){c.underline=true;}if(g.getAttribute("ov")){c.overline=true;}if(g.getAttribute("lt")){c.lineThrough=true;}return c;}},$load:function(){Echo.Serial.addPropertyTranslator("Font",this);Echo.Serial.addPropertyTranslator("F",this);}});
Echo.Serial.ImageReference=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(b,c){var d;if(c.firstChild.nodeType==1){var f=c.firstChild;d=f.firstChild.data;if(b.decompressUrl){d=b.decompressUrl(d);}var e=f.getAttribute("w");e=e?e:null;var a=f.getAttribute("h");a=a?a:null;if(e||a){return{url:d,width:e,height:a};}else{return d;}}else{d=c.firstChild.data;return b.decompressUrl?b.decompressUrl(d):d;}}},$load:function(){Echo.Serial.addPropertyTranslator("ImageReference",this);Echo.Serial.addPropertyTranslator("I",this);}});Echo.Serial.LayoutData=Core.extend(Echo.Serial.PropertyTranslator,{$static:{toProperty:function(a,b){var d={};var c=b.firstChild;while(c){if(c.nodeType==1){if(c.nodeName=="p"){Echo.Serial.loadProperty(a,c,null,d);}}c=c.nextSibling;}return d;}},$load:function(){Echo.Serial.addPropertyTranslator("LayoutData",this);Echo.Serial.addPropertyTranslator("L",this);}});