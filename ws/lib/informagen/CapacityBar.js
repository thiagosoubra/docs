if(!Core.get(window,["Informagen"])){Core.set(window,["Informagen"],{});}Informagen.CapacityBar=Core.extend(Echo.Component,{$load:function(){Echo.ComponentFactory.registerType("Informagen.CapacityBar",this);},componentType:"Informagen.CapacityBar",focusable:false});Informagen.CapacityBar.Peer=Core.extend(Echo.Render.ComponentSync,{$load:function(){Echo.Render.registerPeer("Informagen.CapacityBar",this);},renderAdd:function(b,a){this.divElement=document.createElement("div");this.divElement.id=this.component.renderId;a.appendChild(this.divElement);this.renderUpdate(b);},renderUpdate:function(update){var div=this.divElement;while(div.hasChildNodes()){div.removeChild(div.firstChild);}var parameters=[];var string;parameters.width=Echo.Sync.Extent.toPixels(this.component.render("width",460),true);parameters.width=Math.max(parameters.width,48);parameters.height=Echo.Sync.Extent.toPixels(this.component.render("height",18),false);parameters.height*=3/2;parameters.height=Math.max(parameters.height,12);
string=this.component.render("reflectivity","0.75");parameters.reflectivity=eval(string);parameters.reflectivity=Math.min(Math.max(parameters["reflectivity"],0.001),1);parameters.showTicks=this.component.render("showTicks",true);string=this.component.render("tickSpacing",null);parameters.tickSpacing=eval(string);string=this.component.render("cornerRadius","1.0");parameters.cornerRadius=eval(string);parameters.cornerRadius=Math.min(Math.max(parameters["cornerRadius"],0.001),1);string=this.component.render("colors","['#3765d9','#9ede7c','#9e42ee','#ec7612','#00aaaa','#cc0000','#aaaa00','#008000']");parameters.colors=eval(string);string=this.component.render("values",null);parameters.values=eval(string);var canvas=document.createElement("canvas");if(canvas&&(typeof(canvas.getContext)!=="undefined")){canvas.getContext("2d");canvas.height=parameters.height;canvas.width=parameters.width;div.appendChild(canvas);this._createCapacityBar(canvas,parameters);}else{this._createStyledCapacityBar(parameters);
}return false;},renderDispose:function(a){delete this.divElement;},_createCapacityBar:function(c,p){var k;var n;var f;var m=0;var a=0;var j=parseInt((c.height)/3);var o=c.height-j;var r=c.width;var e;var l;if(p.values){a=p.values.length;for(var g=0;g<a;g++){m+=Math.abs(p.values[g]);}}if(p.tickSpacing!=null&&p.values!=null&&m>0){e=r*(p.tickSpacing/m);}else{e=p.width/20;}l=Math.round((r)/e)-1;k=parseInt(j*p.cornerRadius);try{var q=c.getContext("2d");q.clearRect(0,0,c.width,c.height);q.beginPath();q.moveTo(0,o-k);q.quadraticCurveTo(0,o,k,o);q.quadraticCurveTo(0,o,0,o+k);q.lineTo(0,o+j);q.lineTo(r,o+j);q.lineTo(r,o+k);q.quadraticCurveTo(r,o,r-k,o);q.quadraticCurveTo(r,o,r,o-k);q.lineTo(r,k);q.quadraticCurveTo(r,0,r-k,0);q.lineTo(k,0);q.quadraticCurveTo(0,0,0,k);q.closePath();q.clip();q.fillStyle="rgba(204, 204, 204, 1.0)";q.fillRect(0,0,c.width,c.height);if(p.values&&m>0){var h=0;for(var g=0;g<a;g++){f=p.colors[g%(p.colors.length)];var b=r*(Math.abs(p.values[g])/m);q.fillStyle=f;q.fillRect(h,0,b,c.height);
h+=b;}}n=q.createLinearGradient(0,0,0,o);n.addColorStop(0,"rgba(255,255,255, 0.55)");n.addColorStop(1,"rgba(  0,  0,  0, 0.60)");q.fillStyle=n;q.fillRect(0,0,r,o);if(p.showTicks){q.lineWidth=0.65;n=q.createLinearGradient(0,0.5,0,c.height);n.addColorStop(0,"rgba(255,255,255,1.0)");n.addColorStop(0.66,"rgba(255,255,255,0.7)");n.addColorStop(1,"rgba(255,255,255,0.2)");for(var g=1;g<=l;g++){q.beginPath();q.moveTo(g*e,0.5);q.lineTo(g*e,c.height);q.strokeStyle="rgba(0,0,0,0.75)";q.stroke();q.beginPath();q.moveTo(g*e+0.5,0.5);q.lineTo(g*e+0.5,c.height);q.strokeStyle=n;q.stroke();}}n=q.createLinearGradient(0,o,0,c.height);n.addColorStop(0,"rgba(0,0,0,1.0)");n.addColorStop(0.1,"rgba(0,0,0,0.5)");n.addColorStop(0.5,"rgba(0,0,0,0.0)");n.addColorStop(1,"rgba(0,0,0,0.0)");q.fillStyle=n;q.fillRect(0,o,r,c.height);q.globalCompositeOperation="xor";n=q.createLinearGradient(0,o,0,c.height);n.addColorStop(1,"rgba(0, 0, 0, 1.0)");n.addColorStop(0,"rgba(0, 0, 0,"+(1-p.reflectivity)+")");q.fillStyle=n;q.fillRect(0,o,r,c.height);
q.restore();}catch(d){this.divElement.innerHTML="CapacityBar - exception";}return false;},_createStyledCapacityBar:function(k){var e;var h=0;var a=0;var j=k.height;var l=k.width;if(k.values){a=k.values.length;for(var f=0;f<a;f++){h+=Math.abs(k.values[f]);}}var b=document.createElement("div");b.style.margin="0px";b.style.position="relative";b.style.borderTop="1px solid #cccccc";b.style.borderRight="1px solid #888888";b.style.borderLeft="1px solid #cccccc";b.style.borderBottom="1px solid #888888";b.style.background="#cccccc";b.style.padding="0px";b.style.height=j+"px";b.style.width=l+"px";if(k.values&&h>0){var g=0;for(var f=0;f<a;f++){var d=document.createElement("div");d.style.position="absolute";e=k.colors[f%(k.colors.length)];d.style.background=e;var c=l*(Math.abs(k.values[f])/h);d.style.top="0px";d.style.width=(l-g)+"px";d.style.height=j+"px";d.style.left=g+"px";b.appendChild(d);g+=c;}}this.divElement.appendChild(b);return false;}});