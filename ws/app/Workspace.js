WS.Workspace=Core.extend(Echo.ContentPane,{$static:{tabData:{fileBrowser:{libraries:WS.MODULE_FILE_BROWSER,create:function(){return new WS.FileBrowser();}},music:{libraries:WS.MODULE_MUSIC,create:function(){return new WS.Music();}},photos:{libraries:WS.MODULE_PHOTOS,create:function(){return new WS.Photos();}},videos:{libraries:WS.MODULE_VIDEOS,create:function(){return new WS.Videos();}},status:{libraries:WS.MODULE_STATUS,create:function(){return new WS.Status();}},upgrade:{libraries:WS.MODULE_UPGRADE,create:function(){return new WS.Upgrade();}}},MenuStateModel:Core.extend(Extras.MenuStateModel,{$construct:function(a){this.workspace=a;},isEnabled:function(a){return this.workspace.activeTab?this.workspace.activeTab.isOptionEnabled(a):true;},isSelected:function(a){return this.workspace.activeTab?this.workspace.activeTab.isOptionSelected(a):false;},setSelected:function(b,a){if(this.workspace.activeTab){this.workspace.activeTab.setOptionSelected(b,a);}}})},_r:null,_tabPane:null,activeTab:null,sidePane:null,_uploadContainer:null,_uploadMonitor:null,_activeTabComponent:null,xfile:null,_uploadIdsPendingStore:null,_uploading:false,_uploadStatusRunnable:null,$construct:function(){this._r=WS.getResources();
this._menuStateModel=new WS.Workspace.MenuStateModel(this);this._uploadIdsPendingStore=[];Echo.ContentPane.call(this,{events:{init:Core.method(this,function(a){if(this._tabPane.children.length>0){var b=this._tabPane.children[0].get("id");this._loadTab(this._tabPane.children[0],b);}}),dispose:Core.method(this,function(a){this._disposeActiveTab();})},children:[this._contentSplit=new Echo.SplitPane({autoPositioned:true,orientation:Echo.SplitPane.ORIENTATION_VERTICAL_BOTTOM_TOP,children:[this._uploadContainer=new Echo.Column({layoutData:{overflow:Echo.SplitPane.OVERFLOW_HIDDEN}}),new Echo.SplitPane({orientation:Echo.SplitPane.ORIENTATION_HORIZONTAL,separatorColor:"#232325",separatorPosition:"20em",resizable:true,children:[new Echo.SplitPane({layoutData:{minimumSize:"15em",maximumSize:"30em"},orientation:Echo.SplitPane.ORIENTATION_VERTICAL_TOP_BOTTOM,autoPositioned:true,children:[new Echo.SplitPane({orientation:Echo.SplitPane.ORIENTATION_VERTICAL_TOP_BOTTOM,autoPositioned:true,children:[new Echo.Row({layoutData:{background:"#232325",overflow:Echo.SplitPane.OVERFLOW_HIDDEN},foreground:"#ffffff",insets:"2em 1em",children:[new Echo.Label({icon:this._r.i["Application.Logo"]}),new Echo.Label({layoutData:{alignment:"bottom",insets:"0 0 1.1em 1em"},foreground:"#939395",font:{size:"18pt",italic:true,typeface:WS.Style.ROBOTO_LIGHT},text:this._r.m["Application.Title"]})]}),this._menu=new Extras.MenuBarPane({layoutData:{overflow:Echo.SplitPane.OVERFLOW_HIDDEN},styleName:"Default",stateModel:this._menuStateModel,events:{action:Core.method(this,this._processMenuAction)}})]}),this.sidePane=new Echo.ContentPane({background:"#7f7f7f",foreground:"#ffffff"})]}),this._tabPane=new Extras.TabPane({layoutData:{background:"#dfdfdf"},background:"#ffffff",tabCloseEnabled:true,tabCloseIconRolloverEnabled:true,styleName:"Default",events:{tabSelect:Core.method(this,this._processTabSelect)},children:[]})]})]})]});
if(WS.user.owner||WS.user.permissions.fileAccess){this._tabPane.add(new Echo.ContentPane({id:"fileBrowser",layoutData:{title:this._r.m["Tab.FileBrowser"]}}));}if(!WS.lite&&(WS.user.owner||WS.user.permissions.musicAccess)){this._tabPane.add(new Echo.ContentPane({id:"music",layoutData:{title:this._r.m["Tab.Music"],activeBackground:"#4f5f4f",activeForeground:"#dfdfdf"}}));}if(!WS.lite&&(WS.user.owner||WS.user.permissions.photoAccess)){this._tabPane.add(new Echo.ContentPane({id:"photos",layoutData:{title:this._r.m["Tab.Photos"],activeBackground:"#2f2f2f",activeForeground:"#dfdfdf"}}));}if(!WS.lite&&(WS.user.owner||WS.user.permissions.videoAccess)){this._tabPane.add(new Echo.ContentPane({id:"videos",layoutData:{title:this._r.m["Tab.Videos"],activeBackground:"#2f2f2f",activeForeground:"#dfdfdf"}}));}this._tabPane.add(new Echo.ContentPane({id:"status",layoutData:{title:this._r.m["Tab.Status"]}}));if(WS.lite){this._tabPane.add(new Echo.ContentPane({id:"upgrade",layoutData:{title:this._r.m["Tab.Upgrade"],icon:this._r.i["Tab.Upgrade"]}}));
}this._displayQuickTipsIfRequired();},init:function(){this.xfile=new XFile(document.body);this.xfile.setProgressListener(Core.method(this,this._onUploadProgress));},_displayQuickTipsIfRequired:function(){if(!WS.quickTips||WS.pref.quickTipsDisable){return;}this._displayQuickTips();},_displayQuickTips:function(){if(this._quickTipsDialog){return;}this._quickTipsDialog=new Echo.WindowPane({styleName:"Default",title:this._r.m["QuickTips.Title"],font:{typeface:"RobotoLight",size:"12pt"},insets:30,positionX:50,positionY:"80%",events:{close:Core.method(this,function(){WS.pref.quickTipsDisable=true;WS.savePrefs();this.remove(this._quickTipsDialog);this._quickTipsDialog=null;})},children:[new Echo.Column({cellSpacing:20,children:[new WS.HtmlLabel({html:this._r.m["QuickTips.1"]}),new Echo.Label({layoutData:{insets:"0 0 0 10"},font:{size:"10pt",italic:true},text:this._r.m["QuickTips.1b"]}),new Echo.Label({text:this._r.m["QuickTips.2"]}),new WS.HtmlLabel({html:this._r.m["QuickTips.3"]})]})]});this.add(this._quickTipsDialog);
},dispose:function(){if(this.xfile){this.xfile.dispose();this.xfile=null;}},addUploadPendingStore:function(a){if(Core.Arrays.indexOf(this._uploadIdsPendingStore,a)!=-1){return;}this._uploadIdsPendingStore.push(a);this._updateUploadState();if(!this._uploadStatusRunnable){this._uploadStatusRunnable=new WS.Workspace.UploadStatusRunnable(this);Core.Web.Scheduler.add(this._uploadStatusRunnable);}},clearUploadPendingStore:function(){this._uploadStatusRunnable=null;this._uploadIdsPendingStore=[];this._updateUploadState();},_disposeActiveTab:function(){if(this.xfile){this.xfile.setClient(null);}if(this.activeTab){this.activeTab.deactivate(this);this.activeTab=null;}},doUploadStoreComplete:function(){this.clearUploadPendingStore();if(this.activeTab){this.activeTab.onUploadStored();}},_doUploadStop:function(){if(this.xfile){this.xfile.abortAll();}this._uploading=false;this._uploadIdsPendingStore=[];this._updateUploadState();},_notifyReady:function(){},_onUploadProgress:function(a){this._uploading=a.uploading;
this._updateUploadState();if(this._uploadMonitor){this._uploadMonitor.updateProgress(a);}},_updateUploadState:function(){var b=!!(this._uploading||this._uploadIdsPendingStore.length>0);var a=!!this._uploadMonitor;if(a===b){if(this._uploadMonitor){this._uploadMonitor.updateState(this._uploading);}return;}this._uploadMonitor=null;this._uploadContainer.removeAll();if(!b){this._contentSplit.set("separatorPosition",0);if(this.xfile){this.xfile.reset();}return;}this._uploadMonitor=new WS.UploadMonitor(this);this._uploadMonitor.updateState(this._uploading);this._uploadMonitor.addListener("stop",Core.method(this,this._doUploadStop));this._uploadContainer.add(this._uploadMonitor);this._contentSplit.set("separatorPosition",null);},_updateMenuModel:function(){var a=[],e=[],b=[],d=[],c;if(this.activeTab){if(this.activeTab.fileContributions){for(c in this.activeTab.fileContributions){e.push(this.activeTab.fileContributions[c]);}e.push(new Extras.SeparatorModel());}if(this.activeTab.viewContributions){for(c in this.activeTab.viewContributions){b.push(this.activeTab.viewContributions[c]);
}b.push(new Extras.SeparatorModel());}if(this.activeTab.helpContributions){for(c in this.activeTab.helpContributions){d.push(this.activeTab.helpContributions[c]);}d.push(new Extras.SeparatorModel());}}if(!WS.directAccess){e.push(new Extras.OptionModel("exit",this._r.m["Menu.Exit"],this._r.i["Menu.Exit"]));}if(!WS.lite){b.push(new Extras.OptionModel("preferences",this._r.m["Menu.Preferences"],this._r.i["Menu.Preferences"]));}d.push(new Extras.OptionModel("about",this._r.m["Menu.About"],this._r.i["Menu.About"]));d.push(new Extras.OptionModel("doc",this._r.m["Menu.Documentation"],this._r.i["Menu.Documentation"]));d.push(new Extras.OptionModel("faq",this._r.m["Menu.FAQ"],this._r.i["Menu.FAQ"]));d.push(new Extras.OptionModel("tips",this._r.m["Menu.Tips"],this._r.i["Menu.Tips"]));a.push(new Extras.MenuModel(null,this._r.m["Menu.FileMenu"],null,e));if(b.length){a.push(new Extras.MenuModel(null,this._r.m["Menu.ViewMenu"],null,b));}a.push(new Extras.MenuModel(null,this._r.m["Menu.HelpMenu"],null,d));
this._menu.set("model",new Extras.MenuModel(null,null,null,a));},_loadTab:function(b,c){var a=WS.Workspace.tabData[c];if(a){this.application.client.exec(a.libraries,Core.method(this,function(){this.activeTab=a.create();b.add(this.activeTab);this.activeTab.activate(this);this._updateMenuModel();}));}},_processMenuAction:function(b){switch(b.modelId){case"exit":var a=new WS.Dialog(this._r.m["ExitDialog.Title"],this._r.i["Menu.Exit"],this._r.m["ExitDialog.Message"],this._r.i["Dialog.Warning"],WS.Dialog.CONTROLS_YES_NO,Core.method(this,function(c){if(c.actionCommand=="yes"){this.fireEvent({type:"exit",source:this});}}));this.application.content.add(a);break;case"about":this.application.client.exec(WS.MODULE_ABOUT,Core.method(this,function(){this.application.content.add(new WS.AboutDialog());}));break;case"faq":window.open(WS.LINK_URL_DOC_FAQ);break;case"doc":window.open(WS.LINK_URL_DOC);break;case"tips":this._displayQuickTips();break;case"preferences":this.application.client.exec(WS.MODULE_PREFERENCE_EDITOR,Core.method(this,function(){this.application.content.add(new WS.PreferenceEditor());
}));break;default:if(this.activeTab){this.activeTab.doOperation(b.modelId);}}},_processTabSelect:function(a){this._disposeActiveTab();this.sidePane.removeAll();if(a.tab.children.length===0){var b=a.tab.get("id");this._loadTab(a.tab,b);}else{this.activeTab=a.tab.children[0];this.activeTab.activate(this);this._updateMenuModel();}},removeUploadPendingStore:function(a){Core.Arrays.remove(this._uploadIdsPendingStore,a);this._updateUploadState();}});WS.Workspace.DeleteConfirmDialog=Core.extend(Echo.WindowPane,{$construct:function(a,b){this._r=WS.getResources();var c;Echo.WindowPane.call(this,{styleName:"Default",modal:true,resizable:false,closable:false,title:this._r.m["DeleteConfirm.Title"],icon:this._r.i["DeleteConfirm.Icon"],width:"32em",events:{init:Core.method(this,function(d){this.application.setFocusedComponent(this._cancelButton);})},children:[new Echo.SplitPane({styleName:"ControlPane.SplitBottom",children:[new Echo.Row({styleName:"ControlPane",children:[this._okButton=new Echo.Button({styleName:"ControlPane",text:this._r.m["DeleteConfirm.Action"],icon:this._r.i["DeleteConfirm.Action"],events:{action:Core.method(this,function(d){this.parent.remove(this);
if(b){b({source:this,type:"action"});}})}}),this._cancelButton=new Echo.Button({styleName:"ControlPane",text:this._r.m["DeleteConfirm.DoNothing"],icon:this._r.i["Generic.Cancel"],events:{action:Core.method(this,function(d){this.parent.remove(this);})}})]}),new Echo.Column({insets:"1em 0",cellSpacing:"1em",children:[new Echo.Row({layoutData:{insets:"0 1em"},cellSpacing:"1em",children:[new Echo.Label({icon:this._r.i["Dialog.Warning"]}),new Echo.Label({text:this._r.m["DeleteConfirm.Message"]})]}),c=new Echo.Panel({border:{top:"1px solid #afaf4f",bottom:"1px solid #afaf4f",left:null,right:null},background:"#ffffdf",insets:"2em"}),new Echo.Label({layoutData:{insets:"0 1em"},text:this._r.m["DeleteConfirm.Message2"]}),new Echo.Panel({layoutData:{insets:"0 1em"},border:"1px dashed #ff0000",background:"#ffdfdf",insets:"1em",children:[new Echo.CheckBox({text:this._r.m["DeleteConfirm.ConfirmText"],events:{action:Core.method(this,function(d){this._okButton.setEnabled(d.source.get("selected"));})}})]})]})]})]});
if(a){c.add(a);}this._okButton.setEnabled(false);}});WS.Workspace.UploadStatusRunnable=Core.extend(Core.Web.Scheduler.Runnable,{_workspace:null,timeInterval:1000,$construct:function(a){this._workspace=a;},_processResponse:function(b){var a=b.source.getResponseHeader("X-WebSharing-Upload-Complete")=="1";if(a){this._workspace.doUploadStoreComplete();}else{Core.Web.Scheduler.add(this);}},run:function(){Core.Debug.consoleWrite("uploadStatus check");var c=this._workspace._uploadIdsPendingStore.join(",");var a=WS.Synchronize.getUploadStoreStatusUrl(c);var b=new Core.Web.HttpConnection(a,"GET");b.addResponseListener(Core.method(this,this._processResponse));b.connect();}});WS.WorkspaceModule=Core.extend(Echo.ContentPane,{$virtual:{activate:function(a){},deactivate:function(a){},fileContributions:null,viewContributions:null,helpContributions:null,isOptionEnabled:function(a){return true;},isOptionSelected:function(a){return false;},setOptionSelected:function(b,a){},doOperation:function(a){},onUploadStored:function(){},getUploadClient:function(){return null;
}}});