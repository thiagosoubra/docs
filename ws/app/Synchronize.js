WS.Synchronize=Core.extend({$static:{getUploadStoreStatusUrl:function(a){var b=WS.SERVER_URL+"uploadstorestatus?upload-group-id="+a;return WS.Server.Security.signUrl(b);},getTouchUrl:function(){var a=WS.SERVER_URL+"touch";return WS.Server.Security.signUrl(a);}},storageBase:null,mediaIndex:null,server:null,$construct:function(a){this.server=a;this.storageBase=WS.pref.fileStorageBase||"external";this.mediaIndex=WS.pref.mediaIndex||"default";}});WS.Synchronize.Audio=Core.extend(WS.Synchronize,{getArtUrl:function(b){var a=WS.SERVER_URL+"audioart?id="+b;if(this.mediaIndex){a+="&media="+this.mediaIndex;}return WS.Server.Security.signUrl(a);},getDownloadUrl:function(b){var d,c;if(b.trackIds){c="tracks";d=b.trackIds;}else{if(b.albumIds){c="albums";d=b.albumIds;}}var a=WS.SERVER_URL+"audiodownload?"+c+"="+d.join(",");if(this.mediaIndex){a+="&media="+this.mediaIndex;}return WS.Server.Security.signUrl(a);},getHtml5UploadUrl:function(){var a=WS.SERVER_URL+"upload5";a+="?base="+this.storageBase;return WS.Server.Security.signUrl(a);
},getUploadUrl:function(a){var b=WS.SERVER_URL+"upload";if(a){b+=";jsessionid="+WS.session;}if(this.mediaIndex){b+="?media="+this.mediaIndex;}return b;},getUrl:function(a){return WS.Server.Security.signUrl(WS.SERVER_URL+"audio?id="+a.id+"&media="+this.mediaIndex);},listAlbums:function(c,e,d){var a=Core.method(this,function(n){var k=n.element.firstChild;var m=parseInt(k.getAttribute("count"),10);var h=[];var j=k.firstChild;while(j){var l={index:parseInt(WS.Server.DOM.getPropertyElementValue(j,"index"),10),id:WS.Server.DOM.getPropertyElementValue(j,"id"),name:WS.Server.DOM.getPropertyElementValue(j,"name"),artist:WS.Server.DOM.getPropertyElementValue(j,"artist"),art:WS.Server.DOM.getPropertyElementValue(j,"art")};h.push(l);j=j.nextSibling;}var g=parseInt(k.getAttribute("start-index"),10);var i=parseInt(k.getAttribute("end-index"),10);c({count:m,items:h,startIndex:e,endIndex:d});});var f=this.server.invoke("audio",a,{replace:true});var b=f.ownerDocument.createElement("list");if(this.mediaIndex){b.setAttribute("media",this.mediaIndex);
}b.setAttribute("type","albums");b.setAttribute("start-index",e);b.setAttribute("end-index",d);f.appendChild(b);},listArtists:function(c,e,d){var a=Core.method(this,function(n){var k=n.element.firstChild;var m=parseInt(k.getAttribute("count"),10);var h=[];var j=k.firstChild;while(j){var l={index:parseInt(WS.Server.DOM.getPropertyElementValue(j,"index"),10),id:WS.Server.DOM.getPropertyElementValue(j,"id"),name:WS.Server.DOM.getPropertyElementValue(j,"name")};h.push(l);j=j.nextSibling;}var g=parseInt(k.getAttribute("start-index"),10);var i=parseInt(k.getAttribute("end-index"),10);c({count:m,items:h,startIndex:e,endIndex:d});});var f=this.server.invoke("audio",a,{replace:true});var b=f.ownerDocument.createElement("list");if(this.mediaIndex){b.setAttribute("media",this.mediaIndex);}b.setAttribute("type","artists");b.setAttribute("start-index",e);b.setAttribute("end-index",d);f.appendChild(b);},listPlaylists:function(c,e,d){var a=Core.method(this,function(n){var k=n.element.firstChild;var m=parseInt(k.getAttribute("count"),10);
var h=[];var j=k.firstChild;while(j){var l={index:parseInt(WS.Server.DOM.getPropertyElementValue(j,"index"),10),id:WS.Server.DOM.getPropertyElementValue(j,"id"),name:WS.Server.DOM.getPropertyElementValue(j,"name")};h.push(l);j=j.nextSibling;}var g=parseInt(k.getAttribute("start-index"),10);var i=parseInt(k.getAttribute("end-index"),10);c({count:m,items:h,startIndex:e,endIndex:d});});var f=this.server.invoke("audio",a,{replace:true});var b=f.ownerDocument.createElement("list");if(this.mediaIndex){b.setAttribute("media",this.mediaIndex);}b.setAttribute("type","playlists");b.setAttribute("start-index",e);b.setAttribute("end-index",d);f.appendChild(b);},listTracks:function(c,e,f,d){var a=Core.method(this,function(o){var l=o.element.firstChild;var n=parseInt(l.getAttribute("count"),10);var i=[];var k=l.firstChild;while(k){var m={index:parseInt(WS.Server.DOM.getPropertyElementValue(k,"index"),10),id:WS.Server.DOM.getPropertyElementValue(k,"id"),name:WS.Server.DOM.getPropertyElementValue(k,"name"),artist:WS.Server.DOM.getPropertyElementValue(k,"artist"),album:WS.Server.DOM.getPropertyElementValue(k,"album"),duration:WS.Server.DOM.getPropertyElementValue(k,"duration"),type:WS.Server.DOM.getPropertyElementValue(k,"type")};
i.push(m);k=k.nextSibling;}var h=parseInt(l.getAttribute("start-index"),10);var j=parseInt(l.getAttribute("end-index"),10);c({count:n,items:i,startIndex:f,endIndex:d});});var g=this.server.invoke("audio",a,{replace:true});var b=g.ownerDocument.createElement("list");if(this.mediaIndex){b.setAttribute("media",this.mediaIndex);}b.setAttribute("type","tracks");b.setAttribute("start-index",f);b.setAttribute("end-index",d);g.appendChild(b);if(e){if(e.artist){WS.Server.DOM.setPropertyElementValue(b,"artist",e.artist);}if(e.album){WS.Server.DOM.setPropertyElementValue(b,"album",e.album);}if(e.playlist){WS.Server.DOM.setPropertyElementValue(b,"playlist",e.playlist);}}},uploadStore:function(b,c,f){var a=Core.method(this,function(g){b(g.element.firstChild.nodeValue);});var e=this.server.invoke("audio",a,{block:true});var d=e.ownerDocument.createElement("upload-store");d.setAttribute("base",c);WS.Server.DOM.setPropertyElementValue(d,"upload-id",f);e.appendChild(d);},uploadStore5:function(f,a,b){var e=Core.method(this,function(i){f(i.element.firstChild.nodeValue);
});var h=this.server.invoke("audio",e,{block:false});var g=h.ownerDocument.createElement("upload-store-5");g.setAttribute("upload-group-id",a);h.appendChild(g);for(var d=0;d<b.length;++d){var c=h.ownerDocument.createElement("item");c.setAttribute("base",b[d].storageBase);g.appendChild(c);WS.Server.DOM.setPropertyElementValue(c,"upload-id",b[d].uploadId);WS.Server.DOM.setPropertyElementValue(c,"item-path",b[d].itemPath);WS.Server.DOM.setPropertyElementValue(c,"storage-path",b[d].storagePath);}}});WS.Synchronize.Auth=Core.extend(WS.Synchronize,{load:function(d){var b=Core.method(this,function(h){WS.authUid=WS.Server.DOM.getPropertyElementValue(h.element,"uid");WS.directAccess=WS.Server.DOM.getPropertyElementValue(h.element,"direct")=="1";WS.lite=WS.Server.DOM.getPropertyElementValue(h.element,"lite")=="1";WS.version=WS.Server.DOM.getPropertyElementValue(h.element,"version");WS.locale=WS.Server.DOM.getPropertyElementValue(h.element,"locale");WS.quickTips=WS.Server.DOM.getPropertyElementValue(h.element,"tips")=="1";
WS.setAccessTimeout(parseInt(WS.Server.DOM.getPropertyElementValue(h.element,"timeout"),10));var g=h.element.getElementsByTagName("storage");if(g&&g[0]){var f=g[0].firstChild;while(f){switch(f.nodeName){case"storage-base":WS.storage.push({name:f.getAttribute("name"),displayName:f.firstChild.nodeValue});break;case"media-index":WS.mediaIndices.push({name:f.getAttribute("name"),displayName:f.firstChild.nodeValue});break;}f=f.nextSibling;}}d();});var a=this.server.invoke("auth",b,{block:true});var c=this.server.document.createElement("load");a.appendChild(c);},login:function(e,c){var a=WS.Server.Security.hashPassword(c);var d=Core.method(this,function(k){var g=WS.Server.DOM.getPropertyElementValue(k.element,"status");switch(g){case"accept":WS.session=WS.Server.DOM.getPropertyElementValue(k.element,"session");WS.user={owner:WS.Server.DOM.getPropertyElementValue(k.element,"owner")=="true",password:c,permissions:{}};var j=k.element.getElementsByTagName("permission");for(var h=0;h<j.length;++h){WS.user.permissions[j[h].firstChild.nodeValue]=true;
}e(true);break;case"decline":e(false);break;case"invaliduid":e(false,true);break;default:throw new Error("Invalid server authentication response.");}});var b=this.server.invoke("auth",d,{block:true});var f=this.server.document.createElement("login");b.appendChild(f);WS.Server.DOM.setPropertyElementValue(f,"passhash",a);WS.Server.DOM.setPropertyElementValue(f,"uid",WS.authUid);},logout:function(c){var b=Core.method(this,function(g){var f=WS.Server.DOM.getPropertyElementValue(g.element,"status");if(f=="exit"){WS.user=null;c(true);}else{throw new Error("Invalid server authentication response.");}});var a=this.server.invoke("auth",b,{block:true});var d=this.server.document.createElement("logout");a.appendChild(d);}});WS.Synchronize.File=Core.extend(WS.Synchronize,{$static:{processThumbnailData:function(b,a){a.thumbnailReady=b.getAttribute("thumbnail-state")=="ready";if(a.thumbnailReady){a.thumbnailContentType=b.getAttribute("thumbnail-type");a.thumbnailWidth=parseInt(b.getAttribute("thumbnail-width"),10);
a.thumbnailHeight=parseInt(b.getAttribute("thumbnail-height"),10);}else{a.thumbnailAvailable=b.getAttribute("thumbnail-state")=="available";}}},deleteFile:function(e,h,a){var d=Core.method(this,function(i){e(i.element.firstChild.nodeValue);});var g=this.server.invoke("file",d,{block:true});var f=g.ownerDocument.createElement("delete");if(this.storageBase){f.setAttribute("base",this.storageBase);}f.setAttribute("path",h);g.appendChild(f);for(var c=0;c<a.length;++c){var b=g.ownerDocument.createElement("item");b.appendChild(g.ownerDocument.createTextNode(a[c]));f.appendChild(b);}},getUrl:function(d,b,a){d=WS.Util.encodeURIComponent(d);var c=WS.SERVER_URL+"file?path="+d;if(b){c+="&attach=1";}if(a){c+="&cutoff="+a;}if(this.storageBase){c+="&base="+this.storageBase;}return WS.Server.Security.signUrl(c);},getThumbnailUrl:function(b){b=WS.Util.encodeURIComponent(b);var a=WS.SERVER_URL+"thumbnail?path="+b;if(this.storageBase){a+="&base="+this.storageBase;}return WS.Server.Security.signUrl(a);},getThumbnailGenerationUrl:function(b){b=WS.Util.encodeURIComponent(b);
var a=WS.SERVER_URL+"thumbnailgen?path="+b;if(this.storageBase){a+="&base="+this.storageBase;}return WS.Server.Security.signUrl(a);},getStreamUrl:function(b){b=WS.Util.encodeURIComponent(b);var a=WS.SERVER_URL+"stream?path="+b;if(this.storageBase){a+="&base="+this.storageBase;}return WS.Server.Security.signUrl(a);},getDownloadUrl:function(c){var a=[WS.SERVER_URL,"download?"];for(var b=0;b<c.length;++b){a.push("path="+WS.Util.encodeURIComponent(c[b]));if(b<c.length-1){a.push("&");}}if(this.storageBase){a.push("&base="+this.storageBase);}return WS.Server.Security.signUrl(a.join(""));},getHtml5UploadUrl:function(){var a=WS.SERVER_URL+"upload5";a+="?base="+this.storageBase;return WS.Server.Security.signUrl(a);},getUploadUrl:function(a){var b=WS.SERVER_URL+"upload";if(a){b+=";jsessionid="+WS.session;}if(this.storageBase){b+="?base="+this.storageBase;}return b;},listFiles:function(c,f,g,e){var a=Core.method(this,function(m){var n=WS.Server.DOM.getPropertyElementValue(m.element,"error");if(n){c({error:n});
}else{var p=m.element.firstChild;var l=parseInt(p.getAttribute("count"),10);var h=[];var i=p.firstChild;while(i){var j={name:i.firstChild.nodeValue};if(i.getAttribute("directory")=="true"){j.directory=true;}else{j.size=parseInt(i.getAttribute("size"),10);}j.date=parseInt(i.getAttribute("date"),10)*1000;WS.Synchronize.File.processThumbnailData(i,j);h.push(j);i=i.nextSibling;}var q=p.getAttribute("path");var o=parseInt(p.getAttribute("start-index"),10);var k=parseInt(p.getAttribute("end-index"),10);c({path:q,count:l,files:h,startIndex:g,endIndex:e});}});var d=this.server.invoke("file",a,{replace:true});var b=WS.Server.DOM.setPropertyElementValue(d,"list",f.path);if(f.showHidden){b.setAttribute("hidden",true);}if(this.storageBase){b.setAttribute("base",this.storageBase);}b.setAttribute("start-index",g);b.setAttribute("end-index",e);d.appendChild(b);},newFolder:function(d,c,f){var a=Core.method(this,function(g){d(g.element.firstChild.nodeValue);});var e=this.server.invoke("file",a,{block:true});
var b=WS.Server.DOM.setPropertyElementValue(e,"new-folder",f);if(this.storageBase){b.setAttribute("base",this.storageBase);}b.setAttribute("parent",c);},relocateFiles:function(g,e,a,j,h,b){var f=Core.method(this,function(i){g(i.element.firstChild.nodeValue);});var c=this.server.invoke("file",f,{block:true});var l=c.ownerDocument.createElement(b?"copy":"move");l.setAttribute("source-base",e);l.setAttribute("source",a);l.setAttribute("target-base",this.storageBase);l.setAttribute("target",h);c.appendChild(l);for(var k=0;k<j.length;++k){var d=c.ownerDocument.createElement("item");d.appendChild(c.ownerDocument.createTextNode(j[k]));l.appendChild(d);}},renameFile:function(c,e,a){var b=Core.method(this,function(g){c(g.element.firstChild.nodeValue);});var d=this.server.invoke("file",b,{block:true});var f=WS.Server.DOM.setPropertyElementValue(d,"rename",a);if(this.storageBase){f.setAttribute("base",this.storageBase);}f.setAttribute("path",e);},uploadStore:function(b,g,d,f){var a=Core.method(this,function(h){b(h.element.firstChild.nodeValue);
});var c=this.server.invoke("file",a,{block:true});var e=c.ownerDocument.createElement("upload-store");e.setAttribute("base",d);c.appendChild(e);WS.Server.DOM.setPropertyElementValue(e,"upload-id",g);WS.Server.DOM.setPropertyElementValue(e,"storage-path",f);},uploadStore5:function(f,a,b){var e=Core.method(this,function(i){f(i.element.firstChild.nodeValue);});var g=this.server.invoke("file",e,{block:false});var h=g.ownerDocument.createElement("upload-store-5");h.setAttribute("upload-group-id",a);g.appendChild(h);for(var d=0;d<b.length;++d){if(b[d].uploadId==null){continue;}var c=g.ownerDocument.createElement("item");c.setAttribute("base",b[d].storageBase);h.appendChild(c);WS.Server.DOM.setPropertyElementValue(c,"upload-id",b[d].uploadId);WS.Server.DOM.setPropertyElementValue(c,"item-path",b[d].itemPath);WS.Server.DOM.setPropertyElementValue(c,"storage-path",b[d].storagePath);}}});WS.Synchronize.Image=Core.extend(WS.Synchronize,{deleteImage:function(e,d){var c=Core.method(this,function(h){e(h.element.firstChild.nodeValue);
});var g=this.server.invoke("image",c,{block:true});var f=g.ownerDocument.createElement("delete");if(this.mediaIndex){f.setAttribute("media",this.mediaIndex);}g.appendChild(f);for(var b=0;b<d.length;++b){var a=g.ownerDocument.createElement("item");a.appendChild(g.ownerDocument.createTextNode(d[b]));f.appendChild(a);}},getDownloadUrl:function(b){var d,c;if(b.imageIds){c="images";d=b.imageIds;}else{if(b.folderIds){c="folders";d=b.folderIds;}}var a=WS.SERVER_URL+"imagedownload?"+c+"="+d.join(",");if(this.mediaIndex){a+="&media="+this.mediaIndex;}return WS.Server.Security.signUrl(a);},getUrl:function(c,a){var b=WS.SERVER_URL+"image?id="+c.id+"&date="+c.date;if(a){b+="&thumb=1";}if(this.mediaIndex){b+="&media="+this.mediaIndex;}return WS.Server.Security.signUrl(b);},listFolders:function(c,f,d){var a=Core.method(this,function(n){var h=n.element.firstChild;var m=parseInt(h.getAttribute("count"),10);var k=[];var j=h.firstChild;while(j){var l={id:WS.Server.DOM.getPropertyElementValue(j,"id"),name:WS.Server.DOM.getPropertyElementValue(j,"name")};
k.push(l);j=j.nextSibling;}var g=parseInt(h.getAttribute("start-index"),10);var i=parseInt(h.getAttribute("end-index"),10);c({count:m,folders:k,startIndex:f,endIndex:d});});var e=this.server.invoke("image",a,{replace:true});var b=e.ownerDocument.createElement("list");if(this.mediaIndex){b.setAttribute("media",this.mediaIndex);}b.setAttribute("type","folders");b.setAttribute("start-index",f);b.setAttribute("end-index",d);e.appendChild(b);},listImages:function(c,e,g,d){var a=Core.method(this,function(n){var o=n.element.firstChild;var l=parseInt(o.getAttribute("count"),10);var h=[];var k=o.firstChild;while(k){var m={id:WS.Server.DOM.getPropertyElementValue(k,"id"),date:WS.Server.DOM.getPropertyElementValue(k,"date"),thumbWidth:parseInt(WS.Server.DOM.getPropertyElementValue(k,"thumb-width"),10),thumbHeight:parseInt(WS.Server.DOM.getPropertyElementValue(k,"thumb-height"),10),contentType:WS.Server.DOM.getPropertyElementValue(k,"type")};h.push(m);k=k.nextSibling;}var i=parseInt(o.getAttribute("start-index"),10);
var j=parseInt(o.getAttribute("end-index"),10);c({count:l,images:h,startIndex:g,endIndex:d});});var f=this.server.invoke("image",a,{replace:true});var b=f.ownerDocument.createElement("list");if(this.mediaIndex){b.setAttribute("media",this.mediaIndex);}b.setAttribute("type","images");if(e){if(e.folder){b.setAttribute("folder",e.folder);}else{if(e.all){b.setAttribute("all","1");}}}b.setAttribute("start-index",g);b.setAttribute("end-index",d);f.appendChild(b);}});WS.Synchronize.Status=Core.extend(WS.Synchronize,{getStatus:function(b,c){var a=Core.method(this,function(g){var d={battery:parseInt(WS.Server.DOM.getPropertyElementValue(g.element,"battery"),10),processorUsage:parseInt(WS.Server.DOM.getPropertyElementValue(g.element,"processor-usage"),10),charging:WS.Server.DOM.getPropertyElementValue(g.element,"charging")=="true",wireless:parseInt(WS.Server.DOM.getPropertyElementValue(g.element,"wireless"),10),storage:[]};var f=g.element.firstChild;while(f){if(f.nodeName=="storage"){d.storage.push({name:f.getAttribute("name"),displayName:f.getAttribute("display-name"),available:f.getAttribute("available"),capacity:f.getAttribute("capacity")});
}f=f.nextSibling;}b(d);});this.server.invoke("status",a);}});WS.Synchronize.Video=Core.extend(WS.Synchronize,{thumbSupport:false,deleteVideo:function(e,g){var c=Core.method(this,function(h){e(h.element.firstChild.nodeValue);});var d=this.server.invoke("video",c,{block:true});var f=d.ownerDocument.createElement("delete");if(this.mediaIndex){f.setAttribute("media",this.mediaIndex);}d.appendChild(f);for(var b=0;b<g.length;++b){var a=d.ownerDocument.createElement("item");a.appendChild(d.ownerDocument.createTextNode(g[b]));f.appendChild(a);}},getDownloadUrl:function(b){var d,c;if(b.videoIds){c="videos";d=b.videoIds;}var a=WS.SERVER_URL+"videodownload?"+c+"="+d.join(",");if(this.mediaIndex){a+="&media="+this.mediaIndex;}return WS.Server.Security.signUrl(a);},getThumbUrl:function(b){var a=WS.SERVER_URL+"videothumb?id="+b.id;if(this.mediaIndex){a+="&media="+this.mediaIndex;}return WS.Server.Security.signUrl(a);},getUrl:function(b){var a=WS.SERVER_URL+"video?id="+b.id;if(this.mediaIndex){a+="&media="+this.mediaIndex;
}return WS.Server.Security.signUrl(a);},listVideos:function(d,f,g,e){var a=Core.method(this,function(o){var n=o.element.firstChild;if(!this.thumbSupport&&n.getAttribute("thumbs")=="1"){this.thumbSupport=true;}var m=parseInt(n.getAttribute("count"),10);var k=[];var j=n.firstChild;while(j){var l={id:WS.Server.DOM.getPropertyElementValue(j,"id"),contentType:WS.Server.DOM.getPropertyElementValue(j,"type"),title:WS.Server.DOM.getPropertyElementValue(j,"title")};k.push(l);j=j.nextSibling;}var h=parseInt(n.getAttribute("start-index"),10);var i=parseInt(n.getAttribute("end-index"),10);d({count:m,videos:k,startIndex:g,endIndex:e});});var c=this.server.invoke("video",a,{replace:true});var b=c.ownerDocument.createElement("list");if(this.mediaIndex){b.setAttribute("media",this.mediaIndex);}b.setAttribute("type","videos");if(f){if(f.all){b.setAttribute("all","1");}}b.setAttribute("start-index",g);b.setAttribute("end-index",e);c.appendChild(b);}});