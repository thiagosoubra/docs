WS={URL_PASS_EXPR:/(\?|&)p=([0-9a-z]+)/,STORED_PASS_EXPR:/WSPass=([0-9a-z]+);?/,_COOKIE:/WSPref\=(.*?)(?:;|$)/,LINK_URL_DOC:"http://android.nextapp.com/site/websharing/doc",LINK_URL_DOC_FAQ:"http://android.nextapp.com/site/websharing/doc/faq",MODULE_ABOUT:["lib/extras/Application.TabPane.js","lib/extras/Sync.TabPane.js","app/About.js"],MODULE_PREFERENCE_EDITOR:["lib/echo/Sync.ToggleButton.js","app/PreferenceEditor.js"],MODULE_WORKSPACE:["lib/extras/Application.TabPane.js","lib/extras/Sync.TabPane.js","lib/xfile/XFile.js","app/EventContainer.js","app/Slider.js","app/Workspace.js","app/UploadMonitor.js"],MODULE_FILE_BROWSER:["lib/echo/Sync.List.js","lib/echo/Sync.ToggleButton.js","lib/extras/Application.AccordionPane.js","lib/extras/Application.Viewer.js","lib/extras/Application.ListViewer.js","lib/extras/Application.FlowViewer.js","lib/extras/Sync.AccordionPane.js","lib/extras/Sync.Viewer.js","lib/extras/Sync.ListViewer.js","lib/extras/Sync.FlowViewer.js","app/Flow.js","app/ViewerUtil.js","app/FileBrowser.js"],MODULE_DISPLAY_IMAGE:["app/ImageDisplay.js"],MODULE_DISPLAY_TEXT:["app/TextDisplay.js"],MODULE_HTML5_VIDEO_PLAYER:["app/VideoPlayer.js","app/Html5VideoPlayer.js"],MODULE_FLASH_VIDEO_PLAYER:["app/VideoPlayer.js","lib/flowplayer/flowplayer-3.2.12.min.js","app/FlashVideoPlayer.js"],MODULE_PHOTOS:["lib/extras/Application.Viewer.js","lib/extras/Application.ListViewer.js","lib/extras/Application.FlowViewer.js","lib/extras/Sync.Viewer.js","lib/extras/Sync.ListViewer.js","lib/extras/Sync.FlowViewer.js","app/ViewerUtil.js","app/ImageDisplay.js","app/Photos.js"],MODULE_MUSIC:["lib/soundmanager/soundmanager2.js","lib/soundmanager/config.js","lib/echo/Sync.ToggleButton.js","lib/extras/Application.Viewer.js","lib/extras/Application.ListViewer.js","lib/extras/Application.FlowViewer.js","lib/extras/Sync.Viewer.js","lib/extras/Sync.ListViewer.js","lib/extras/Sync.FlowViewer.js","app/TrackDescription.js","app/Slider.js","app/ViewerUtil.js","app/RGB.js","app/Music.js"],MODULE_VIDEOS:["lib/extras/Application.Viewer.js","lib/extras/Application.FlowViewer.js","lib/extras/Sync.Viewer.js","lib/extras/Sync.FlowViewer.js","app/ViewerUtil.js","app/Videos.js"],MODULE_STATUS:["lib/echo/Sync.List.js","lib/informagen/CapacityBar.js","app/Status.js"],MODULE_UPGRADE:["app/Upgrade.js"],MODULE_UPLOAD:["lib/filetransfer/Application.UploadSelect.js","lib/filetransfer/Sync.UploadSelect.js","lib/filetransfer/Application.MultipleUploadSelect.js","lib/filetransfer/SWFUpload.js","lib/filetransfer/Sync.MultipleUploadSelect.js","app/Upload.js"],MODULE_LOCALE:{fr:["app/Resource_fr.js"]},accessMonitor:null,pref:{},storage:[],mediaIndices:[],uploadManager:null,loadPrefs:function(){WS.pref.multipleUpload=true;
WS.pref.fileListView=false;WS.pref.videoAuto=true;try{var b=WS._COOKIE.exec(document.cookie);if(b&&b[1]){var c=decodeURIComponent(b[1]);var a=c.split(",");if(a.length>=1){WS.pref.multipleUpload=a[0]=="1";WS.pref.videoAuto=a[1]=="3";WS.pref.videoHtml5=a[1]=="2";WS.pref.videoFlash=a[1]=="1";WS.pref.fileListView=a[2]=="1";WS.pref.fileStorageBase=a[3];WS.pref.mediaIndex=a[4];WS.pref.quickTipsDisable=a[5];}WS.savePrefs();}}catch(d){alert("Failed to retrieve preferences: "+d);}},savePrefs:function(){var b=new Date();b.setFullYear(b.getFullYear()+1);var a=[WS.pref.animationEnabled?1:0,WS.pref.videoFlash?1:(WS.pref.videoHtml5?2:(WS.pref.videoAuto?3:0)),WS.pref.fileListView?1:0,WS.pref.fileStorageBase||"external",WS.pref.mediaIndex||"default",WS.pref.quickTipsDisable?1:0];var c=a.join(",");document.cookie="WSPref="+encodeURIComponent(c)+";"+b.toGMTString();},SERVER_URL:"/service/",user:null,flashAvailable:false,getResources:function(){return{m:WS.Messages.get(WS.locale),i:WS.Images.get(WS.locale)};
},_getStoredPassword:function(){var a=window.name||"";var b=WS.STORED_PASS_EXPR.exec(a);return b?b[1]:null;},init:function(a,e){if(this._processUrlPassword()){return;}Core.Web.init();WS.loadPrefs();if(Core.Web.Env.ENGINE_MSHTML){document.documentElement.style.overflow="hidden";if(Core.Web.Env.ENGINE_VERSION_MAJOR<=6){WS.Server.retryTimes=[5000,15000];}}if(Echo.DebugConsole){Echo.DebugConsole.install();}if(Core.Web.Env.ENGINE_MSHTML){try{this.flashAvailable=!!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash.9"));}catch(g){}}else{if(navigator.plugins){for(var f=0;f<navigator.plugins.length;++f){if(/flash/gi.test(navigator.plugins[f].name)){var d=/[0-9]+/g.exec(navigator.plugins[f].description);if(d){var c=parseInt(d[0],10);this.flashAvailable=c>=9;}}}}}this.clientId=new Date().getTime().toString(36)+"_"+parseInt(Math.random()*(1<<30),10).toString(36);this.accessMonitor=new WS.AccessMonitor();var h=new WS.App(this._getStoredPassword());var b=new Echo.FreeClient(h,document.getElementById(a));
b.addResourcePath("Echo","lib/echo/");b.addResourcePath("Extras","lib/extras/");b.addResourcePath("FileTransfer","lib/filetransfer/");b.addResourcePath("WS","app/");WS.Style.init();h.setStyleSheet(WS.Style.styleSheet);b.init();},_processUrlPassword:function(){var b=document.URL.toString();var a=WS.URL_PASS_EXPR.exec(b);if(!a){return false;}this.storePassword(a[2]);var c=b.replace(WS.URL_PASS_EXPR,a[1]+"pr=1");window.location.href=c;return true;},setAccessTimeout:function(a){this.accessMonitor.setAccessTimeout(a);},storePassword:function(b){var a=window.name||"";if(!/;$/.test(a)){a+=";";}a=a.replace(WS.STORED_PASS_EXPR,"");if(b){a+="WSPass="+b+";";}window.name=a;},touch:function(a){this.accessMonitor.touch(a);}};WS.App=Core.extend(Echo.Application,{$static:{_activeApp:null,displayError:function(b,a){if(this._activeApp){this._activeApp.displayError(b,a);}else{alert("Error"+"\n\n"+(b||"")+"\n\n"+(a||""));}}},server:null,content:null,$construct:function(a){Echo.Application.call(this);this._password=a;
if(!this._password){this._displayWelcome(false);}WS.App._activeApp=this;},displayError:function(d,c){var b=WS.getResources();var a=new WS.Dialog(d||b.m["Generic.ErrorDialog.Title"],null,c||b.m["Generic.ErrorDialog.Message"],b.i["Dialog.Error"],WS.Dialog.CONTROLS_OK);this.content.add(a);},displayVideo:function(d,c,b){var a;if(WS.pref.videoAuto){if(d in WS.ContentType.CONTENT_TYPES_VIDEO_HTML5){this._displayVideoHtml5(c,b);}else{this._displayVideoFlash(c,b);}}else{if(WS.pref.videoFlash){this._displayVideoFlash(c,b);}else{if(WS.pref.videoHtml5){this._displayVideoHtml5(c,b);}}}},_displayVideoFlash:function(b,a){this.client.exec(WS.MODULE_FLASH_VIDEO_PLAYER,Core.method(this,function(){var c=new WS.FlashVideoPlayerWindow(b);c.addListener("download",Core.method(this,function(d){top.location=a;}));c.addListener("switchToHtml5",Core.method(this,function(d){this._displayVideoHtml5(b,a);}));this.content.add(c);}));},_displayVideoHtml5:function(b,a){this.client.exec(WS.MODULE_HTML5_VIDEO_PLAYER,Core.method(this,function(){var c=new WS.Html5VideoPlayerWindow(b);
c.addListener("download",Core.method(this,function(d){top.location=a;}));c.addListener("switchToFlash",Core.method(this,function(d){this._displayVideoFlash(b,a);}));this.content.add(c);}));},_display:function(a){if(this.content&&this.content.dispose){this.content.dispose();}this.rootComponent.removeAll();this.content=a;this.rootComponent.add(this.content);if(this.content&&this.content.init){this.content.init();}},_displayWorkspace:function(){this.client.exec(WS.MODULE_WORKSPACE,Core.method(this,function(){var a=new WS.Workspace();a.addListener("exit",Core.method(this,this._processExit));this._display(a);}));},_displayWelcome:function(b){var a=new WS.WelcomeScreen(b);a.addListener("authRequest",Core.method(this,this._processAuthRequest));this._display(a);},_processExpire:function(a){if(a){this._sessionExpired();}},_processTouch:function(c){var a=WS.Synchronize.getTouchUrl();var b=new Core.Web.HttpConnection(a,"GET");b.addResponseListener(Core.method(this,this._processTouchResponse));b.connect();
},_processTouchResponse:function(a){WS.accessMonitor.touch(false);},_processAuthRequest:function(b){var a=new WS.Synchronize.Auth(this.server);a.login(Core.method(this,function(d,c){if(d){WS.storePassword(b.password);this._displayWorkspace();}else{if(c){this._sessionExpired();}else{b.source.displayInvalidLogin();}}}),b.password);},init:function(){Echo.Application.prototype.init.call(this);WS.accessMonitor.onServerKeepAliveListener=Core.method(this,this._processTouch);WS.accessMonitor.onExpireListener=Core.method(this,this._processExpire);this.server=new WS.Server(this.client,WS.SERVER_URL);this.server.addListener("error",Core.method(this,function(c){var b="Could not communicate with server.";if(this.client){this.client.fail(b);}else{alert(b);}}));var a=new WS.Synchronize.Auth(this.server);a.load(Core.method(this,this._processInit2));},_processInit2:function(){if(WS.locale&&WS.MODULE_LOCALE[WS.locale]){this.client.exec(WS.MODULE_LOCALE[WS.locale],Core.method(this,function(){this._processInit3();
}));}else{this._processInit3();}},_processInit3:function(){if(!this._password){this._processInit4();return;}var a=new WS.Synchronize.Auth(this.server);a.login(Core.method(this,function(c,b){if(c){this._displayWorkspace();}else{if(b){this._sessionExpired();}else{WS.storePassword(null);this._displayWelcome(false);}}this._processInit4();}),this._password);},_processInit4:function(){if(this.content&&this.content.start){this.content.start();}},_processExit:function(b){WS.storePassword(null);var a=new WS.Synchronize.Auth(this.server);a.logout(Core.method(this,function(){this._displayWelcome(true);}));},_sessionExpired:function(){this.client.displayError(null,"Session Expired",null,"Continue",function(){window.location.reload();},Echo.Client.STYLE_MESSAGE);}});WS.AccessMonitor=Core.extend({_timeout:0,_runnable:null,onExpireListener:null,onServerKeepAliveListener:null,_lastAccessTime:0,_queued:false,$construct:function(){this._lastAccessTime=new Date().getTime();this._runnable=new Core.Web.Scheduler.MethodRunnable(Core.method(this,this._check),1000,false);
},_check:function(){this._queued=false;if(this._timeout<=0){return;}var c=this._lastAccessTime+(this._timeout*1000);var b=new Date().getTime();var a=c-b;if(a<0){if(this.onExpireListener){this.onExpireListener(true);}}else{if(a<60*1000){if(this.onExpireListener){this.onExpireListener(false);}this._queueCheck();}else{this._queueCheck();}}},_queueCheck:function(){Core.Web.Scheduler.remove(this._runnable);Core.Web.Scheduler.add(this._runnable);this._queued=true;},setAccessTimeout:function(a){this.touch();this._timeout=a;this._queueCheck();},touch:function(a){if(a){var c=this._lastAccessTime+(this._timeout*1000);var b=c-new Date().getTime();if(b<60*1000){if(this.onServerKeepAliveListener){this.onServerKeepAliveListener();}else{Core.Debug.consoleWrite("Keep alive required and no listener configured.");}}}else{this._lastAccessTime=new Date().getTime();}}});WS.ContentType=Core.extend({$static:{CONTENT_TYPES_VIDEO:{"video/mp4":true,"video/3gpp":true,"video/avi":true,"video/x-ms-wmv":true,"video/x-m4v":true,"video/ogg":true,"video/webm":true,"video/x-matroska":true},CONTENT_TYPES_VIDEO_HTML5:{"video/mp4":true,"video/ogg":true,"video/webm":true,"video/x-matroska":true},_extensionToDescriptor:{},Descriptor:Core.extend({$construct:function(a,d,c,b){this.name=a;
this.iconName=d;this.extensions=b;this.contentType=c;},canDisplayAsImage:function(){return this.contentType in {"image/jpeg":true,"image/gif":true,"image/png":true};},canDisplayAsText:function(){return this.contentType&&this.contentType.indexOf("text/")===0;},canDisplayAsVideo:function(){return this.contentType in WS.ContentType.CONTENT_TYPES_VIDEO;}}),getContentType:function(a){var b=this.getDescriptor(a);return b==null?null:b.contentType;},getDescriptor:function(a){var b=a.lastIndexOf(".");if(b!==-1){a=a.substring(b+1);}a=a.toLowerCase();return this._extensionToDescriptor[a];},_register:function(b){for(var a=0;a<b.extensions.length;++a){var c=b.extensions[a];if(!this._extensionToDescriptor[c]){this._extensionToDescriptor[c]=b;}}}},$load:function(){this._register(new this.Descriptor("Microsoft Word Document","document","application/msword",["doc","dot","docx"]));this._register(new this.Descriptor("Microsoft Excel Document","spreadsheet","application/vnd.ms-excel",["xla","xlc","xlm","xls","xlt","xlw","xlsx"]));
this._register(new this.Descriptor("Microsoft PowerPouint Document","presentation","application/vnd.ms-powerpoint",["pot","pps","ppt","pptx"]));this._register(new this.Descriptor("PDF Document","document","application/pdf",["pdf"]));this._register(new this.Descriptor("Rich Text Document","document","application/rtf",["rtf"]));this._register(new this.Descriptor("Tar/GZip Archive","package_archive","application/x-compressed",["tgz"]));this._register(new this.Descriptor("Compressed Archive","package_archive","application/x-compress",["z"]));this._register(new this.Descriptor("Zip Archive","package_archive","application/zip",["zip"]));this._register(new this.Descriptor("Jar Archive","package_archive","application/jar",["jar","ear","war"]));this._register(new this.Descriptor("Android Package","package_android","application/vnd.android.package-archive",["apk"]));this._register(new this.Descriptor("GZip Archive","package_archive","application/x-gzip",["gz","gzip"]));this._register(new this.Descriptor("HTML Document","text_html","text/html",["html","html"]));
this._register(new this.Descriptor("Text Document","text","text/plain",["txt","text"]));this._register(new this.Descriptor("Source Code","text_source","text/plain",["c","h","m","cpp","pas","java","js","php","css","pl","sql","xml"]));this._register(new this.Descriptor("MPEG Video","video","video/mpeg",["mp2","mpa","mpe","mpeg","mpg","mpv2"]));this._register(new this.Descriptor("Ogg Audio","audio","audio/ogg",["oga"]));this._register(new this.Descriptor("Ogg Video","video","video/ogg",["ogv"]));this._register(new this.Descriptor("Matroska Video","video","video/x-matroska",["mkv"]));this._register(new this.Descriptor("MP4 Video","video","video/mp4",["mp4"]));this._register(new this.Descriptor("M4V Video","video","video/x-m4v",["m4v"]));this._register(new this.Descriptor("3GPP Video","video","video/3gpp",["3gp","3gpp"]));this._register(new this.Descriptor("WebM Video","video","video/webm",["webm"]));this._register(new this.Descriptor("Windows Media Video","video","video/x-ms-wmv",["wmv"]));
this._register(new this.Descriptor("Windows Media Audio","music","audio/x-ms-wma",["wma"]));this._register(new this.Descriptor("WAVE Audio","music","audio/wav",["wav"]));this._register(new this.Descriptor("MP3 Audio","music","audio/mpeg",["mp3"]));this._register(new this.Descriptor("JPEG Image","image","image/jpeg",["jpg","jpeg","jpe"]));this._register(new this.Descriptor("TIFF Image","image","image/tiff",["tif","tiff"]));this._register(new this.Descriptor("GIF Image","image","image/gif",["gif"]));this._register(new this.Descriptor("BMP Image","image","image/bmp",["bmp"]));this._register(new this.Descriptor("PNG Image","image","image/png",["png"]));this._register(new this.Descriptor("SVG Image","image","image/svg+xml",["svg"]));this._register(new this.Descriptor("Icon Image","image","image/x-icon",["ico"]));this._register(new this.Descriptor("Windows Executable","executable","application/octet-stream",["exe","com"]));this._register(new this.Descriptor("Windows Library","executable","application/octet-stream",["dll"]));
this._register(new this.Descriptor("Mac OS Disk Image","package_archive","application/octet-stream",["dmg"]));this._register(new this.Descriptor("Debian Software Package","package_archive","application/octet-stream",["deb"]));this._register(new this.Descriptor("RPM Software Package","package_archive","application/octet-stream",["rpm"]));}});