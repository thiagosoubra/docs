WS.Status=Core.extend(WS.WorkspaceModule,{_updateRunnable:null,_storage:null,_battery:null,_wireless:null,_cpu:null,$construct:function(){this._updateRunnable=new Core.Web.Scheduler.MethodRunnable(Core.method(this,this._updateStatus),5000,false);this._r=WS.getResources();var b;WS.WorkspaceModule.call(this,{events:{init:Core.method(this,Core.method(this,function(d){this._syncStatus=new WS.Synchronize.Status(this.application.server);}))},children:[new Echo.Column({insets:10,cellSpacing:20,children:[b=new Echo.Grid({width:"100%",cellWidth:["50%","50%"],insets:"10 20"})]})]});this._battery=new WS.StatusWidget(this._r.m["Status.Battery"],this._r.i["Status.Battery"],"#00ff00");b.add(this._battery);this._wireless=new WS.StatusWidget(this._r.m["Status.Wireless"],this._r.i["Status.Wireless"],"#ff4faf");b.add(this._wireless);this._cpu=new WS.StatusWidget(this._r.m["Status.ProcessorUsage"],this._r.i["Status.ProcessorUsage"],"#00ff7f");b.add(this._cpu);if(WS.storage.length>1){b.add(new Echo.Panel());
}this._storage={};for(var a=0;a<WS.storage.length;++a){var c=WS.storage[a];this._storage[c.name]=new WS.StatusWidget(c.displayName,this._r.i["Status.ExternalStorage"],"#4f4fff");b.add(this._storage[c.name]);}},activate:function(a){this._active=true;a.sidePane.add(new Echo.ContentPane({background:"#9d9d9d",children:[new Echo.Column({background:"#7f7f7f",foreground:"#ffffff",insets:"1em",children:[new Echo.Row({cellSpacing:"1ex",children:[new Echo.Label({text:this._r.m["Status.UpdateSpeed"]}),new Echo.SelectField({items:[this._r.m["Status.UpdateNormal"],this._r.m["Status.UpdateFast"]],events:{action:Core.method(this,function(b){this._updateRunnable.timeInterval=b.source.get("selection")===1?1000:5000;Core.Web.Scheduler.add(this._updateRunnable);})}})]})]})]}));this._updateStatus();},deactivate:function(){this._active=false;Core.Web.Scheduler.remove(this._updateRunnable);},_statusProcessor:function(b){if(!this._active){return;}this._battery.setValue(b.battery);if(b.battery<15){this._battery.setCapacityColor("#ff0000");
}else{if(b.battery<25){this._battery.setCapacityColor("#ffaf00");}else{if(b.battery<35){this._battery.setCapacityColor("#afff00");}else{this._battery.setCapacityColor("#00ff00");}}}this._battery.setIcon(this._r.i[b.charging?"Status.BatteryCharging":"Status.Battery"]);this._battery.setDescription(this._r.m["Status.BatteryState"]+" "+b.battery+"%\n"+this._r.m[b.charging?"Status.BatteryChargingTrue":"Status.BatteryChargingFalse"]);this._wireless.setValue(b.wireless);this._wireless.setDescription(this._r.m["Status.WirelessStrength"]+" "+b.wireless+"%");for(var c=0;c<b.storage.length;++c){var d=b.storage[c];var a=this._storage[d.name];if(a){a.setValue(100-parseInt(100*d.available/d.capacity,10));a.setDescription(this._r.m["Status.MediaCapacity"]+" "+WS.Util.formatBytes(d.capacity)+"\n"+this._r.m["Status.MediaUsage"]+" "+WS.Util.formatBytes(d.capacity-d.available)+"\n"+this._r.m["Status.MediaAvailable"]+" "+WS.Util.formatBytes(d.available));}}this._cpu.setValue(b.processorUsage/10);this._cpu.setDescription(this._r.m["Status.CPU"]+" "+Math.round(b.processorUsage/10)+"%");
Core.Web.Scheduler.add(this._updateRunnable);},_updateStatus:function(){this._syncStatus.getStatus(Core.method(this,this._statusProcessor));}});WS.StatusWidget=Core.extend(Echo.Panel,{descriptionLabel:null,content:null,capacityBar:null,iconLabel:null,$construct:function(c,b,a){Echo.Panel.call(this,{layoutData:{alignment:{vertical:"top",horizontal:"left"}},children:[new Echo.Row({layoutData:{alignment:"top"},cellSpacing:"1em",children:[this.iconLabel=new Echo.Label({layoutData:{alignment:"top"},icon:b}),this.content=new Echo.Column({layoutData:{alignment:"top"},insets:"10 0 0 0",cellSpacing:2,children:[new Echo.Label({foreground:"#7f7f7f",text:c,font:{size:"14pt",typeface:WS.Style.ROBOTO_LIGHT}}),this.capacityBar=new Informagen.CapacityBar({reflectivity:0.4,tickSpacing:10,cornerRadius:0,width:200,values:[0,100],colors:[a,"#dfdfdf"]}),this.descriptionLabel=new Echo.Label({font:{size:"8pt"},formatWhitespace:true})]})]})]});},setIcon:function(a){this.iconLabel.set("icon",a);},setCapacityColor:function(a){this.capacityBar.set("colors",[a,"#dfdfdf"]);
},setValue:function(a){this.capacityBar.set("values",[a,100-a]);},setDescription:function(a){this.descriptionLabel.set("text",a);}});